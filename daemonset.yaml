
---

---

---
apiVersion: v1
kind: Secret
metadata:
  name: twistlock-secrets
  namespace: twistlock
type: Opaque
data:
  service-parameter: MDRlemlpdE0wVlQzOGZsMXZQd2Rud3FjM0pFVXZHTDlnUTUrSDF3OVFJVTBqK0o1c0pWbEJ2RElaeVBhSE5jRG8zSXlSZ0VkY3dLazUwcmw5VFZXSUE9PQ==
  defender-ca.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURIRENDQWdTZ0F3SUJBZ0lRWFdabXJuUzdZMk9NV0pDYVV4MkNPVEFOQmdrcWhraUc5dzBCQVFzRkFEQW8KTVJJd0VBWURWUVFLRXdsVWQybHpkR3h2WTJzeEVqQVFCZ05WQkFNVENWUjNhWE4wYkc5amF6QWVGdzB5TXpBeApNamt4TmpRMU1EQmFGdzB5TmpBeE1qZ3hOalExTURCYU1DZ3hFakFRQmdOVkJBb1RDVlIzYVhOMGJHOWphekVTCk1CQUdBMVVFQXhNSlZIZHBjM1JzYjJOck1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0MKQVFFQXVpaDRUL3JLSGJUdXB2ZVYwdkZMSm9hQXk0aWNndzFJN2ZKUVFlQlZTb01nWEtmZFhBVThoY1JBS2hnMwpha08vTDJHV1MxYVhiamhUYXhreDRwU28zR1ZZWTZSeHRpUGs2ZXpDQ1E5YklxSzh1SE9HTzd3Rk5jMjg4YWZHCjR4alhOYUltUUFLTEJTdm9HY0FFem1BeWVUNWo3SjhpRXZIZ1N1ek5QQVN0bE1YZ2ZVZEVNdlpieGZIMzNnMk4KTkJEWk8xRVFnZkdwOTU0b05LazdGYVgzU2l6L2RyRXNMbUYwZ2hqbWVkSFVhM01US3R1ZTE0V29UbDNRR0VDNApka09mMXczNkVIMmJLNmM5Um5LMWpXdkdwc1dHK1ZMREJld28wVHhnZXp6Yjg2ZzVZakVYVU9pYVpnT0VNLzk0Cm90UWRVLzZ2TTdRWjkrb21ibjl0dGFKb3hRSURBUUFCbzBJd1FEQU9CZ05WSFE4QkFmOEVCQU1DQXF3d0R3WUQKVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVUwampUUWJYLzFMeG0ydkQxWWhQSmFQYWx2dkF3RFFZSgpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFKVk9Cemd2dEZMYnlKL3VWYWJRTmJsR2NoMmxXQlVkY080VzNHYzllY2NwCnFLUy83ditJa0NDaVQ1TVN2NTEvdHc3VUdtQVNQMytpNUJSRmxoQmlzRTlPMTBtZDIzNVBxR0dneVo3cHBGSlMKUWQ4ekc5cjU5Z1piMHFzRUhFZU9wK2xPRVozaEVVY1BMVTFMb2QvaHhYaUxWQ1NUZmlxZ1U3NWVGZmxiMDAzRQpsL29aUUNZYUVpTFl5Zldna1MrZm1ERGhvODVwYjdoaitGK1FzL1Q1cTM3bUZwWk5qdm5CcGUvUVhEdEVUUm1QClJJWEhtOUtERG1TbUJPRFRIMXhLZThBbzVWQWo5ZGMveVZ3TGR5QmNOVVNiRTVEUmY0QU5NSE03aGxuRGpVdW0KT2VKaDQ4UDh1ck4vcTB2TEUvNHQ2Nktac1FINGhCclRyNzV0VnhIWVNIST0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  defender-client-cert.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURPekNDQWlPZ0F3SUJBZ0lRWlVUbFhQdW5WRmNvaHVQWlZNZlN1REFOQmdrcWhraUc5dzBCQVFzRkFEQW8KTVJJd0VBWURWUVFLRXdsVWQybHpkR3h2WTJzeEVqQVFCZ05WQkFNVENWUjNhWE4wYkc5amF6QWVGdzB5TXpBeApNekV4TVRNMk1EQmFGdzB5TmpBeE16QXhNVE0yTURCYU1DZ3hFakFRQmdOVkJBb1RDVlIzYVhOMGJHOWphekVTCk1CQUdBMVVFQXhNSmJHOWpZV3hvYjNOME1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0MKQVFFQXRwek5zSzhSMjFUaGwwQUlxWkZ6dlg1UUZmYU1rZnl3MG05T1RNdnppREx1L3h5WTFEUndLYWdKd2hhTgpadDlsLzFBUklTVHBEeDFkMzJDcVRKU1A4aW9JVUZJRVRlakxHbW9zbEY1T0NtSXVnY1BDdVJhWDNrV09uTVFvCjZ5aDVFMlVPKytvZytGTDJGNmgzNWJZZ2lDT3l1QzhrMm5XUE02bHBFZ3JyaWlvM05nLzVOY2hxVERzTVNrYmgKWk1PUXhxYUJQVVVNUm0weEwyNktQQnROQ3Nrb3BHa2VpWGhGTFFOV05jSit6MXRrRUZPU2pCUnpVREp3WVJWSwpLNGR1NHd0bW9RaDVocVRQcVhMYkJjVVhQYlZvb2k0MkFJTTJleC90T0R0TGIwTXRnT1VHNnNlL2ZMbmN2RVJUClhXSGlBKzl4ZUovRFREOXhQMC9MYlJ2RC93SURBUUFCbzJFd1h6QU9CZ05WSFE4QkFmOEVCQU1DQjRBd0V3WUQKVlIwbEJBd3dDZ1lJS3dZQkJRVUhBd0l3REFZRFZSMFRBUUgvQkFJd0FEQWZCZ05WSFNNRUdEQVdnQlRTT05OQgp0Zi9VdkdiYThQVmlFOGxvOXFXKzhEQUpCZ1VxQkFFQ0J3UUFNQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUJBUUNsCm9XWEszdiswYUc3UWN6dng1T0g5Mkt0dHliK3QxbzlXcHZudzIwcVRVeG1ZY1ZWSGVUUDI5SUU3L1E3UzlDTlQKY0F3MjFQOG9XQXp1WEpRckxoUkRtbFNaMDVXSno3Vm1USHdyT1BIclhSd3dMNWR6QlZHOHUxMExPdDBKeUdWVgpWVFpHRzE2dURzb2UreG9oTnd4Rng1NURWQitlZHFrMVJwR0YzQVlneW9KTXMwMStQcE5WU1R5STFLWG9zU1VOCm9xOEIwMDROZUZIZDF2a0RZN1BpZDhLUjBScWFMeTRkN3o5TzM5em52Ykt4aS9GdTc2clJRczVIamoydEROM3cKZ0tCcTdKdkxyWTFpZEh4UkM5aHBFdHZZOTJtMzlCanlGeVFOY1JlcWdYZ1NIcno2NmpnSXlsbjViTlF0WHRLSgpvTnN1R2FjUktXOEw4WjNrTkpTbwotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  defender-client-key.pem: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpQcm9jLVR5cGU6IDQsRU5DUllQVEVECkRFSy1JbmZvOiBBRVMtMjU2LUNCQyxkMmIxYTdjN2ZlZWQwMjQxN2JjYjhjNGZhMmFmMmJiYwoKcHRyMUc1RCt2blVadmttU2tBenRsblB6MG9Dby9jRWRkenhtTXJiVG9WamlrVlJTNUJoUzUwTnU1MUs1YXh5KwpvQ3dWb3UzM25DblNnaGE0Z3NKUTIrL0ExRU4ycENIeng2Rmd2QWwxR0ZVTzNWMFk3ZFlBakQvUFU1QU8vZFpGClNQVm15cW52ZWhwVmlUNXJvbkQ0VkJ1MklySjdwdndnQ0E0eGpZZ0FVdWRSRUtDRjdFRmZydUxkWkxWcUd2TWoKd0lMRWtSckhwa0kvY1I2OFU1bE9OUDNNSGJjMWhLbEhWZUZ1ZTVScnQ1WXNuZzYrUTNWREJrTjI5dnRBV2hldwpJc0swYTlrU1BrMnAzeFAvMXlGKzB5V20xaHM5VVRGcHZseFgzeGxPYm1hQTZxc29jOTFnQ2hubzJEZ2ZiNUo3CjU0ekpPdTI5YWQvZDUreEZ3dE1Vd0VVa3QvMEVPdkcxRlk5TVp4UW5GYWhnNVUyZHhhUGVGQ1kzc21kdHU1VTQKL3BPdzhhY0pJaDF3RXkzM2NmaEY0bFAwTE01TVZ3ZEpoaDd3bmVsYmd1N05mR0NOZVN3L1pTVHNkdDN1TUZSUgp0akJ3SjloRlRIWXVaMDl3ZW95c0tMWXNxcC9XM203cGJzejZHWTN5SWVSUGRnb09YM0pNM0o2Mmc3NkdoZElnClpoQmhnMzl0cDFlTk95RTBLMDlHeHNXMkgzRmM2V1RKMHhjb0RBOCtMaGl6TVF6RWxxKzlQdFNHMHRVdE5Ga0cKTTNEc0U1YzVxL0RLT3lkQng3U1BaQTNxZ2dsSWc3eFE5aUdQOHFQOGF0QnJzTW5uTEwvWWFKSFFSNlZoUXREYgpER1QwZXJLNyt3OUYxcUdmakdrakxUeFBJbFpUWGI4blZTTURyOE8ySkZhRzJ5WFhlbWFydHF0aUVPL2VROU9JClN4TFBwcVM1WnYwSmY0L2tkMjBSdEdsQldRdVRDSkJhb05vbXo4OHkwclhMMmVndGIzUWthdHhSem1KbHBXYk0KaEpsYnVZang5WXFBcWRYVkhhRlZEWXNpZ3YrbTlRMjROb3krNlh3NWRYVFVJeDR5ZGxINHlkMFRQdStFdGY1KwpsbnJEdG1leXIyczJtdzI3eXZCeXQ4Y2hSQXg3RTUycFNMNlNEbU9RZnpxaU1UbkxMT2x6MFUvR0QyVkV1VVpZCmpxL0RpSnRKbktmbk5XK0JkMG5UaHI2SjBWNVYzSnJuazZXUU1kQ2RuTS9JZVM3bGtlVmtpR3hFVzRPdlFYWVEKWHkzUU4rTGNZRDE4TmNCQU5VSHhwWnZnVnVWL3lna2wwY2NFNTZneG1saUc2OXlQSXpDanAvTkdlb2lWclZ0dgpvRkpUUzJZMFhyMHU5cEpueHdSMGp1UDRBWHArNWV6ZDBJU0Z1SnB4Qm8vMDFlTWFwV3V3amUvbW5VUDNETGMyClowcllQb3J6aFRBejBoTERUSU1mN0dVWHA1WEdOeUdscnZjVlRGS2l4NzNYSCtLdDl1T1YyQkhkeU13c1A5Z3cKRFBDNDBVL05Qa3lGZS9ESkw5bFA2THU2UlZCRkZXdzNFME1kb1RwdGRRZk8wUkExMnpXOHNvOEZaK1pIeG9GeQpEbEllcXJiMVZhNXd2d3FyTC92Smc5WHVNd2N0R01wUkhCaTh6Nk00T2NzY25EbmMwYk1ZaTZLODB4NUdkV25MCjcwTk9lVWlDTWdTdnp0M25lQXpCSFd4emJXOTJyamdhdVpRNHJha3c4bG9mUXZIdG9KMnJFNkx2TXR2TitTZEkKUXd1ZWRKNXZpc3lVaCtwMTZZV3dIZG43QVZBYUtaTHZSWStGWGJjWlNnMnorazd2Z1BGaXgxNGV2cjJKaFZLYwpQN1hOUVpvMnNQaXlLRy9iM3JLUUNKeEVFbzJabHB1TjNyN0pucEZpVjBxd1R3ZUJyZkowdGpLR2lrQmFHa09rCjYwN3ozQW5sRW5hYVIzOHBYR2wvTXVpa3VXalcrT0xXdUMyMCtIbzViZ05hWXg2aE8raW9WNWZmd1dZUUFqb1kKM2d5K3ZxakVxTGZhSkxrLzR1Unc3UEk0bE9DQW1uVlZYU0ZZdDRTSVN5cEw3TmQ3N1pBMEM1T0llR29QRGZQSAotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
  admission-cert.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURURENDQWpTZ0F3SUJBZ0lSQU51YmNHdnQ1YUxmV3BqbHVDMGFmWnd3RFFZSktvWklodmNOQVFFTEJRQXcKS0RFU01CQUdBMVVFQ2hNSlZIZHBjM1JzYjJOck1SSXdFQVlEVlFRREV3bFVkMmx6ZEd4dlkyc3dIaGNOTWpNdwpNakF4TVRBMU56QXdXaGNOTWpZd01UTXhNVEExTnpBd1dqQVVNUkl3RUFZRFZRUUtFd2xVZDJsemRHeHZZMnN3CmdnRWlNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUJEd0F3Z2dFS0FvSUJBUURWbWMwdGVOVDRMT2hWOGlIR0ZQajUKNTFLQjlpQ3c1eUR4dE5oZFlpckk4aHpPTmkxR3RQbzQ3MFd0Uk12bU9iOVlKN1d0SEduZ1BSdy8yOTRleWd2ZApObllTQ3pJNkZWRjFxRytRcDY0YWlZbUU4VHY5TjhEMnVUci9FM0sreVNHQ09WUjZIRnJ2WWl2VSsvSlphdlFGCk9kSTBsRjlkMjljVFZmeDlHeTRjSExscjZYZHpHbjlvS1ZTL3lRSjNiYUhsZFJlWUg0dy94UGdDTmpNemZYcGMKTUVtZHBZa2lsRmhLWkd0WUJXdk9xV29VSjNSVzNueEtOU2sweFlMbmhxTW5KU1UvVFhjeTVwY01SWW8waWpJZApqNkZZWVd2dW8wNXFHbzBWc0UvOUFsTEVlaHhYVDRtK0dRb2tvQUk2UU5tWVgrT3pENXorVEFkNENPOStVZXFSCkFnTUJBQUdqZ1lRd2dZRXdEZ1lEVlIwUEFRSC9CQVFEQWdPb01CMEdBMVVkSlFRV01CUUdDQ3NHQVFVRkJ3TUMKQmdnckJnRUZCUWNEQVRBTUJnTlZIUk1CQWY4RUFqQUFNQjhHQTFVZEl3UVlNQmFBRk5JNDAwRzEvOVM4WnRydwo5V0lUeVdqMnBiN3dNQ0VHQTFVZEVRUWFNQmlDRm1SbFptVnVaR1Z5TG5SM2FYTjBiRzlqYXk1emRtTXdEUVlKCktvWklodmNOQVFFTEJRQURnZ0VCQUFZNi95R290MmtGU1RVdm1CVnN2L3BzODdXM2JGUXFHcTlnTjdmZnJ0NVAKSUdjQmI3KzYrYUJBOFNEZHIycHhKTmZZL204VnByYlg1TktmVy90dnorM3p6QUxORlZlZHhpbmpxY3NMRysvTApSOUdZNFNndmt6TWdlT1E1MkRZVkUyY1R6ektxN3ExQ1ljaHJzTmFIZmY5dm1JRGdWcVloa2R3alhsa1Z0cGRDCnpLY3JKNXB2ekUrQ1g4MmZnNkNCQitOOVhPSkdvcUl3ei9qUHhwSFFLQ2dIdTh1dTRoVlhLR1RWR1pkTHpvaC8KQWUrZkdmZ3VDSTBZVkxwSTF5Z1ArQ014RVBxSmFQTEpCcCtIN2JtL251OHZlQjJhNnZYSUt6N2RzLzl1T0YvdQp3TjBEOFdOTXFrL2tseDd5Uk5yMG84cWtGWnRDTGdVbTJqUDZwOUNTdEFZPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  admission-key.pem: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpQcm9jLVR5cGU6IDQsRU5DUllQVEVECkRFSy1JbmZvOiBBRVMtMjU2LUNCQyxlMmM1NDE3ZjQzMGIzNDRlM2U1YzRhYTllNDIyM2NiNwoKZ0pITmJtQUVETlpHeHMxYVduUENycHY2SDYwVnl6MStkcHAxZ290azFsZWxvR2pDWHpTd0grcm5CRmlUZEZRSwpDa3NZWVhSOVFFMkhBeFZuTlVOQjdnYytPOGZLd1RZcjlWd3Jac2JPdmIrYm9yTEROelc5WjFERVVmMHNwMkhzCjNMajMvY3c3ck9yQ1FsMGcxMFk4Tnp5SUVkV2w0QXA5aGVuNTYzNVlrc3BhbVFTTEM0UUVOMkZjbEpTNTZsVWEKb0YvbXg0QjRJK1J1dVU2ejNsWTVyd1F0S0M0ZFptNWVrTmk2YmhlMGFyN3pLOU04T21oUjF1TDJWMjlTWlMyYQp3Tld3NGlZazYwUEN1a0ZLM1pjb1ZLbG9pd3RuUDNzWkJNUTFGMGt2VzR6dUMxVTlFYUxseWNiNlE1Sm0xdjhnCncrK3lYQkpKQUhDZGNzVTJvU0drb3lsbmpJMGtjVnVSQXNqMGVMc0pjL2NKbnc2Y1p2TmZvNTNKQnBDY21Xem8KMHJ6MDhQZmYyS2kzanhqZUx5SHJJMlhTb01aTVFEVER4eEt0RnFwQ1ViNFA5Zzg1N0h1Q3M3L0VnNnhseXVUYgpHakcxVU1rQjhvV2RKL0YvaHpUM2dPWnFFMWgrOWh1WVlMenQ5N2F2OVFrcCtMclVOOXN1RmRSTmlySzF2b1BOCnlLOWc4VmNJd3lrV3BYL3BiMHZlT1VxVFozSWxvbTYxZFl1eGJHN3E1N0VXbWdDMjdVZWI4TWlxVE5hdjE4b0kKUm1yMDZkRHBLTXV6dkpYNnRZMU9tL0Fobm56WHl2Qk90MHI3T2ZJSWcydHVNUWdjZ214UkpBdmJZMkZMV0x5cwprS2VTTEhwQ0x3TG9zVzJleEN3MG5tSVR2U2czMk85VWowTHRFZnBHVi9yWWhuMEEyOXp6cTNnb1N5S2c4Y0ZKCm5UbXFobkhQbzRlaHlmdk9WUXozZGRYR3FKRjFGOHdLeENtam5Ha0NoMk9hVEZYLzd5TTNaNUtJSTAzSGc4NzIKaWEvMTBvZitGcFBhYnkwRUlvUjJLK0pVYTNwdFd3R0QyY3FUeThqZmorNjJNVmlrT0lIVkdvQlRJRWU4c2h0ZAp0U1NTa0hoUUp4TFRmQTdtbVV4RERURWlvRHplVVNMR2pXRUF4WktEdVNuM0daeDhjcmNQZ25wQ3RkZ0JHSlVsCk9hVDBsdklMUTViWWpUdXRtejl5cjZWakgvTlo0cW5CWkxZTWQzajNqMTUvd2NydmtPTnVmSS96ekRBRUcwRkQKNzlNdFlNWFVMNzZHNjU1SzlicE5xcFVnclQreUIxOUhqSFZEeEFjSUxQQUJpcktmU1pCVS9MZVJpYWtzZ0xzRwp0VHNEc0pHY2pYemp1cHozNjh4RDRiUHRuRDBNRzlqWEdvMldPbitSMnRmQWdES3cyYVFHSVJmVWVraDR2VGMwCi9PcnozOTJabmUvWEh6VE9ENjQ4ajRoUUNPNjc0RFE2ZnN4SDl3MWN5YUhYelZ3NTBhRUVNK2g5MXVXb3UzYisKSGt3WnkzZHZ4alcvVGdXVWZ5QWkxbnRCQU5obGlTLzZnZC84QW5oTVdqTFZDRk8vWFA1MmQxRVVjZUFpd0RxdQpNcEVHNmhrdjlrOWxaZk5TL2N3WCtqSVlyQ1hxcFVVNDNhbW04aVNleUUvRDN4UVBCc3pHYUdEaGQxTTUyMFpFCkxYcTA0eEtIWFBScWZiTTV2MG9JU1pGOVFXN1VZazdNemdSSWx1M3NLRzNnN3ZablhhOTlKNlc1eU9NWTF4Z1UKSkxwN1lTcmZWY2ludmNIQVUyaHlhRVRBRnEvRzFwR1kwODUrOFoxcXMzdzVtNzNpMmsyRHBlc2RaZmtnZkdZSwp6U1FuRTV0VzlhWjVZeTQ4SmE2V3hraUJOWVBNaVNjYkxJdUtadGRLK05HT2NpeVREbzBlSEYzUnliUHRLMEdVCjJEK01xcmgvWG00eEwwTlJQNWZmTkpIenU2aXRzRjVJZTMvQmVtYkM4QWpzWTUra3hXbzMrZ1JEckpPU3AwU2QKUWM3cUlKa3EyVGpETWw2Y0d1dkgvRk82NzcxL0NxemM2NERORXFLeXV3NDRvTmRjdEl2RTBDbzRPS2xaMHE5NAotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=

---
apiVersion: v1
kind: ServiceAccount # Service Account is used for managing security context constraints policies in Openshift (SCC)
metadata:
  name: twistlock-service
  namespace: twistlock
secrets:
- name: twistlock-secrets
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: twistlock-defender-ds
  namespace: twistlock
spec:
  selector:
    matchLabels:
      app: twistlock-defender
  template:
    metadata:
      annotations:
        container.apparmor.security.beta.kubernetes.io/twistlock-defender: unconfined
      labels:
        app: twistlock-defender
    spec:
      serviceAccountName: twistlock-service
      restartPolicy: Always
      containers:
      - name: twistlock-defender
        image: registry-auth.twistlock.com/tw_xh82fd7uinul74pwvfiibn09fxe5c6dd/twistlock/defender:defender_22_12_571
        volumeMounts:
        - name: data-folder
          mountPath: "/var/lib/twistlock"
        - name: certificates # Setting the certificates mount after data-folder since it is nested and was overridden in CRI based GKE cluster
          mountPath: "/var/lib/twistlock/certificates"
        - name: docker-sock-folder
          mountPath: "/var/vcap/sys/run/containerd"
        - name: passwd
          mountPath: "/etc/passwd"
          readOnly: true
        - name: syslog-socket
          mountPath: "/dev/log"
        - name: cri-data
          mountPath: /var/lib/containers
        - name: runc-proxy-sock-folder
          mountPath: "/run"
        env:
        - name: WS_ADDRESS
          value: wss://staging-consoles.cloud.twistlock.com:443
        - name: DEFENDER_TYPE
          value: cri
        - name: DEFENDER_LISTENER_TYPE
          value: "none"
        - name: LOG_PROD
          value: "true"
        - name: SYSTEMD_ENABLED
          value: "false"
        - name: DOCKER_CLIENT_ADDRESS
          value: "/var/vcap/sys/run/containerd/containerd.sock"
        - name: DEFENDER_CLUSTER_ID
          value: "df077569-e045-8bb7-faf5-0c9c61f48724"
        - name: DEFENDER_CLUSTER
          value: "tkgi-carlos"
        - name: MONITOR_SERVICE_ACCOUNTS
          value: "false"
        - name: MONITOR_ISTIO
          value: "false"
        - name: COLLECT_POD_LABELS
          value: "false"
        - name: INSTALL_BUNDLE
          value: "eyJzZWNyZXRzIjp7fSwiZ2xvYmFsUHJveHlPcHQiOnsiaHR0cFByb3h5IjoiIiwibm9Qcm94eSI6IiIsImNhIjoiIiwidXNlciI6IiIsInBhc3N3b3JkIjp7ImVuY3J5cHRlZCI6IiJ9fSwiY3VzdG9tZXJJRCI6InBhbnctdHdwZXJmLWRldi0xIiwiYXBpS2V5IjoiUVhBRUlhdDBiTDhIK09heHBNeGhRQ1IreWhLMDdZeW12N3IzOVB5OC9uTGtSNXpFbXVGN2Rhc1RqLzRxb2o3SVBrMkYvSFFjLzJrcXNYVjRNZ3ExTkE9PSIsIm1pY3Jvc2VnQ29tcGF0aWJsZSI6ZmFsc2V9"
        - name: HOST_CUSTOM_COMPLIANCE_ENABLED
          value: "true"
        - name: CLOUD_HOSTNAME_ENABLED
          value: "false"
        - name: FIPS_ENABLED
          value: "false"
        securityContext:
          readOnlyRootFilesystem: true
          privileged: false
          capabilities:
            add:
            - NET_ADMIN  # Required for process monitoring
            - NET_RAW    # Required for iptables (CNNF, runtime DNS, WAAS). See: https://bugzilla.redhat.com/show_bug.cgi?id=1895032
            - SYS_ADMIN  # Required for filesystem monitoring
            - SYS_PTRACE # Required for local audit monitoring
            - SYS_CHROOT # Required for changing mount namespace using setns
            - MKNOD      # A capability to create special files using mknod(2), used by docker-less registry scanning
            - SETFCAP    # A capability to set file capabilities, used by docker-less registry scanning
            - IPC_LOCK   # Required for perf events monitoring, allowing to ignore memory lock limits
        resources: # See: https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#how-pods-with-resource-requests-are-scheduled
          limits:
            memory: "512Mi"
            cpu: "900m"
          requests:
            cpu: "256m"
      volumes:
      - name: certificates
        secret:
          secretName: twistlock-secrets
          defaultMode: 256
      - name: syslog-socket
        hostPath:
          path: "/dev/log"
      - name: data-folder
        hostPath:
          path: "/var/lib/twistlock"
      - name: passwd
        hostPath:
          path: "/etc/passwd"
      - name: docker-sock-folder
        hostPath:
          path: "/var/vcap/sys/run/containerd"
      - name: cri-data
        hostPath:
          path: /var/lib/containers
      - name: runc-proxy-sock-folder
        hostPath:
          path: "/run"
      hostPID: true
      hostNetwork: true
      dnsPolicy: ClusterFirstWithHostNet
---
apiVersion: v1
kind: Service # Expose the Defender as admission controller. Remark: by default, Defender will not listen on the service port
metadata:
  name: defender
  namespace: twistlock
  labels:
    app: twistlock-defender
spec:
  ports:
  - port: 443
    targetPort: 9998
  selector:
    app: twistlock-defender