
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: twistlock-view
rules:
- apiGroups: ["rbac.authorization.k8s.io"]
  resources: ["roles", "rolebindings", "clusterroles", "clusterrolebindings"] # Allow Defenders to list RBAC resources
  verbs: ["list"]
---

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: twistlock-view-binding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: twistlock-view
subjects:
- apiGroup:
  kind: ServiceAccount
  name: twistlock-service
  namespace: twistlock
---

---
apiVersion: v1
kind: Secret
metadata:
  name: twistlock-secrets
  namespace: twistlock
type: Opaque
data:
  service-parameter: NGNNUkQ3anUyMk1FM1B5aDB4b3poSlgwMk5QbkU1Nkt4SitoWS9ISDBaMW5hSFkwSXlVNkVnM0QwRExzZ3lDZW1TdW5QdUxtcXVRd1hIOWlRYXp0Tmc9PQ==
  defender-ca.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURIRENDQWdTZ0F3SUJBZ0lRQlBTeUJmeGFJV1B3MWwwYWV5dFptREFOQmdrcWhraUc5dzBCQVFzRkFEQW8KTVJJd0VBWURWUVFLRXdsVWQybHpkR3h2WTJzeEVqQVFCZ05WQkFNVENWUjNhWE4wYkc5amF6QWVGdzB5TXpBMQpNRGt3TnpRek1EQmFGdzB5TmpBMU1EZ3dOelF6TURCYU1DZ3hFakFRQmdOVkJBb1RDVlIzYVhOMGJHOWphekVTCk1CQUdBMVVFQXhNSlZIZHBjM1JzYjJOck1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0MKQVFFQXl3aWFscEtSbnB5Q1VsZDZ0STVPeDc5WFZQSFpoSHp2V0xsWU9tcFJzalBpbUpxY0hobVliaHQyVDVtbwo1MEpRSFNISGdvcUsrdmlwcUU1cCt4SmJtYzhvTElmY1krbVlYUDE4UFlYcnc5cnAvYnlIYnEwNjN1bmg3QURoCituSUQyQkVmTzVPTU9OVDBsaHRBTk9Zc203Sms3L3hrY1NwQlBLUmh3Sjc2NkN4UkwxWk8wNXdtMTJEaE5CRVUKb2Nnc2JmeTFBWE9IdGhNOGtNL2FVSG91aUE0dnpEN3MwdE54Mm1NMFlaaWx6RUxrTnhNbTY5ZzFVN0YzV0V6YwppZlpuUVRrMjIxT1gvWk9ibmtRZS9JRWlFMVhOcllTV0NZUDlOUFBlMWhGb0ZwTUhMZmc3RjE0QS8wckt2emtnClRwOFlvbEw3RlJvZThTa0RuaTRhakgwaU13SURBUUFCbzBJd1FEQU9CZ05WSFE4QkFmOEVCQU1DQXF3d0R3WUQKVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVVjTk90Z3p0djUyc0M2ZlVvWmNyaTJ3YmRZNEl3RFFZSgpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFFK0FQcW52bWtuNDVlc2lKNkJ2ejNrdDYrclNpVXlNYW0wbXRxRHZDOGczCjVTdy9wV2ZkdnZ5QmZndm1WT00wUkNYOVdHeE5lRVBtdzVBZHdOeE1kV3p0eDhSVkR6MzBXT3F3NW1COG5Ob20KcjdScW5pcUwzUG51aCsxT2V0RlVrOWxuay9sTHdqSXJZUkdSNE0xbm1rR3EyZVdzbklEREQwc3VrVnk3U3k1Qgo5UFFNZ1V2dFFXZTExV09aSDY5Yno0am10ZFlLU05EODQxSW81WE5hRGVaek1LTkY1WUpxbytNeG9oaFoySmg2CmsrS1VuZXoyb2ZkeW5GTmEvcDg1anNxMUhFSStqV2Z4YnhpNENQdUU0elNwRnZ3UGJuMWxscFdCYXM3WVQvajIKczF2ZHZTcFZzMHZZbjQ3bDZIcE02VjhXajJHZVM0Z2ovTXBkTCtWcjJLTT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  defender-client-cert.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURPekNDQWlPZ0F3SUJBZ0lRRUxjaHIzcEpLR0JnVmJ6SytvNTA4REFOQmdrcWhraUc5dzBCQVFzRkFEQW8KTVJJd0VBWURWUVFLRXdsVWQybHpkR3h2WTJzeEVqQVFCZ05WQkFNVENWUjNhWE4wYkc5amF6QWVGdzB5TXpBMQpNVEF3TnpReE1EQmFGdzB5TmpBMU1Ea3dOelF4TURCYU1DZ3hFakFRQmdOVkJBb1RDVlIzYVhOMGJHOWphekVTCk1CQUdBMVVFQXhNSmJHOWpZV3hvYjNOME1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0MKQVFFQXE2c3JrNGdzOWlqWmpDdlY5V3FwTEhiaHp6UXRQZzhWaVBSMXJrMTJYVzVSckNHTnN6MHVvdHVoa0lObwpua3dlK2JXcWZxZWtFU21EZW5zRHpZUUkxOU1YTnhmWlcyUDBScUt6Wk9DWW9kSm9oVWdKbko5RVVnMjgybjcvCnRYNTlwVlJ4T2U4ZExnQlJBdExuekovdEYrWlI5a29TOFFsZXNhd3N0UXYrVE1sNnNXcldISGhLZUVHU0cyYW0KZGZLQ0loRkZzRmgrcHRqRm11ejN3VnNHN0xrSlhRdTRuSEl5bkZjVGJvYUFQZSs1b21vUkZEZnpMNWgydVMxcwpWTEsrNnV2TGxockNqN3VBUjJpK05JaVJBSjdPV0R2V1lBY3lsc0R4ZGJqZ0syR2s5d0Npak81UVg5QXkrYU14CmNnVTludERsaTZWVDNpZTRMQ2RQRE0vSE53SURBUUFCbzJFd1h6QU9CZ05WSFE4QkFmOEVCQU1DQjRBd0V3WUQKVlIwbEJBd3dDZ1lJS3dZQkJRVUhBd0l3REFZRFZSMFRBUUgvQkFJd0FEQWZCZ05WSFNNRUdEQVdnQlJ3MDYyRApPMi9uYXdMcDlTaGx5dUxiQnQxamdqQUpCZ1VxQkFFQ0J3UUFNQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUJBUUJZCmkzbWdsM3lsUU1ZZFY2VFFCUm9Yc0JPbkFRdkkvWlZNdGN4WHArR2g3eDBjODA2bVJheXpIZnJhWkxVTzI4S2MKbjJwdlJWOFdDVDNub3ZtbEhLdnlldENIaUFUUlJEeTROODBxQ0RDTjdPWjBtZ3NYZFRGN1FMem5KUWt3M1hXNwo4bElsQmJkSGNuVVBSa2cwWUMzeDFSaUFhRVkxU2RqMndXeE5qekprZzJDcHUxN29iV3c2Y0ZYR25xT3l0NEhjCmIyNzF4ZzNQOGU1RmdYQkxvOGhVajUwV2cvbnJWaW9Oa2htQ1pHbTBkUndQMkRtbnE1Uy8vZ0JxRmpNQmtCdFgKMy9TOHBIK2gvZ2RKelg3QmFTZTY0OGR2VmpHSFBoTXNqNW4vV3ovYjdBZEh2K2VKU0hBOWNxV3ROdXh3ZEM2RApuMFdVUll1Zk82d3dBYVRHVWVoNAotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  defender-client-key.pem: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpQcm9jLVR5cGU6IDQsRU5DUllQVEVECkRFSy1JbmZvOiBBRVMtMjU2LUNCQyxhMDczMmQ4NzAyNTE1NmExMDhmZjAwZTQ4NjYyZjcxMwoKd0NhMTJma0hQTjNnMFpOaWxqU0ZyM1ZxV0c1MDJURG56RXFZQ3NvUkg0Ukl0b0daMFJEM1I5bnY4dDdJUytTRQozL0M5Qi84eFhpU0V0M3VyNzBUNTdhK3hSZ0NOdmJ4Q1ZvZlRkSGg2cXBqVkdodW1UZGkxQlJ5azlueld2VGZtCmVERnhUTzNmeVNrdlNVcDhOaHZxdDZWVlBZSGhnTkgyWnVML0N3dUliVHI2V0RySmJmcytoTTJZM3hXOWV1L3oKMEJZeDhyRU1teEcwdS9hQ1YrMVFZV1NUeWlpelY2L0tudmZ5aTRSZDc2b0pFM2F6WE80cGUwd2FKT1hKNWxMQQpPaG90MEtFSXhuYkluQk84OWIzT3JwbW1XV3BtOHBCTmF2dHVISm0xNjd4dTFDVU00Szc2QTMzM2o3NlFRZmphCnFoaEp4WUtCakxUTU5hVDlyRlZLTk5ZL0ZTTXJwQ09LRUVHTVByNHE0SzdIMnJtWmtUUEQxKzJZZU5vbkZRaEgKamY3Ym1oSDZpNElIUUc4bWM4Q04wTER0d0hlb0VyK0t3dU1mRjZZWjdNdkM4cGUzSkR3Q09za243T2d5RUpuNQppZzAyN1dKY2VFdW51UnQvU09qVUFYMDNSblo4cXo0Q0pYdE5OMDNyTU5iUzdHNWw1eDhiRG96em1lOEhyazNBCldOcGZ5cFp5VUZrcDBaMjd3cEFYSy9JSUtnZmtzdW1vdU4xZjZIT0piOXR2b3hVbWlETG8vY2d3Wkw4dE16VSsKS0ZhUi92VHJ5NTdHYnAzVjVlN0tvUVJ0bGd4UmdHQ3FSMTNoYlYvQ1QwRHJnYzNuWlpIUWNyRjRBSHpPcXVPbwpLaXorU1B0SDMzYTdjSVFxOFJqellhN3pkc21JWEowc1RCb00ySUhOeEVLODB2OWo3Mk9XNTEyNHFENDhodFkrCjJjRnFVL3hySHFrdmpzUEtsZ1FaUE43Z0lQbVA4Yml1WDh6UjE1WlJTQWZKa3ZpaWpTMWlQWmxjZ04yR2luYzAKWFRMN0JGTElQSlZqQW1DTTVGbGdYVG90ZmxvSkptR1d3dDVUenQ1amdlbGJTTG13OG1RaklVems1MzJyaWEzbwpLdTNEKy9TYnRxWFBVcVZRNTBzRnJyblJyVVZjYkZRVEtEcVJBK3djeTJWR2VycTNFYkZxQkwzR2VyQXZpSjlWCkJmT0l5MlUvcTYvNDRIRVVaNHFEYUVydENETnFJVXBGZGIyVzFSVTY4MHFmYmxSQjcydG9CLzFCVDltNDkrM0cKcENjdTQrd0tLcnNGZzEvOXVaNzlmdGMyV2tlY01pN2c3U0pNai9xa2pIWEszaHplTTFQRzc1MjYyTkhiSWs4QQpCclkvS1duNjFQSHRJV1U3QUQ2aWg0WmVVSjhjdFdrdXI1NXZ4SW9qWERISmlRcUl6VVFlR0R2cW5penBZTGI2CjVNZVoyTlh3dWdRaHE5NGdVU2JVLzFobkFuV29VRHhXN0FxMmxaa216eDhJUkk2bUFoN0lQQTJxVzhKcXVJalMKdFNJN1c5ejlXWUY2UXZOWXpyQ3JqT0VmY003QnBLdGlMeEFOcmFiWnV1NHFpTXgvb2FsbWhrU0NmT3JjRUFvbwpnTHNqTllncEFGOE52Y0piUWxzZ1Y3KzdaUDRSK3JJc1A2OWM5aEJHT1ZpMFRGRjFVTTc4R0ZCa3licjJmSXFoCkM1U3Z3RU1WZHVmY0ZtSTNqUjMrbFcxZmJGUFp5eEt4MDdkdzYyOHpQdXJBUEZTSEF1S3dWNm5DNGtnbHpmTWEKZXR1ZnBwNVE4eUxRTUNhblVmZTZKRkVKbGpyQjhheHl1bTc0THUvVFFEVXYwdnNQMVNPN3ZXdlBNRTdkZS9qMAp0QXVpdmZ0dVRXdTFmME9JQnkvMzBnZUpEWGVJS1dZckhxZ1BkK0gyWjZlWFFjcm9VSUYzS09mTWt0dnZmMmhnCmhVOStRUkdFS093VmY1VmdqZjlPRDI2cklTeHNWSHVTTjV6TGVMNXVYQndRNEZRS0NuYjY5Z2NUQUliNkpyVmMKd3BycDc3MlJtRjhCamg0UVNleVI2cXRVaHRYOVdOTFJXVmJKSmFUSTQ5eFNHMVpMQ2V1eGpsUlNzdWNuWDZWZwotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
  admission-cert.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURTekNDQWpPZ0F3SUJBZ0lRVDBOcE9mYlpvcDVTU29sYWJsQVZLakFOQmdrcWhraUc5dzBCQVFzRkFEQW8KTVJJd0VBWURWUVFLRXdsVWQybHpkR3h2WTJzeEVqQVFCZ05WQkFNVENWUjNhWE4wYkc5amF6QWVGdzB5TXpBMQpNVEF3T0RJd01EQmFGdzB5TmpBMU1Ea3dPREl3TURCYU1CUXhFakFRQmdOVkJBb1RDVlIzYVhOMGJHOWphekNDCkFTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTUtqUDZ3RllmbmQ1Tk50Sm5jRzNRdEUKYW5LOGpHL1E0emZzWmFlcGtFM2g3THlzRlhzbTRlM2xMTlNrQWJtOGhrWTVGdGZpc1A1UDhQOVJxa2pkSnJ0dwpYdS9TRnE5bUVMRlAxblRpNlhLUnpZc0JUSElGUkJzWDNVOXlMdHZDTnNheFJnL1U5Zms2NjNiWUFnUXQ0VHZzCklmWi9NdGJ6WlN0MlREaWZvM1dWN0FXdGdNR29BUGd5SVJyWmpuWU5acHA3bVUvaWVjTjZvNGZ4TGdCTGtidnYKQlFPMlBHTFg0TWF4RXA4L3IzZWVHSzVRTU95bjNrUEtYM2ZCVWM5cFVYdTdmenMxTTVZZmVIdkpaZGZ0TmlqUgpRUlhtOWdlei80cWNzb1poOWVNMURDVVEzeG5ya25yendsblZ4WGFsSmt1OTVtUEluZ0xodnJTRlUzTVd1MDBDCkF3RUFBYU9CaERDQmdUQU9CZ05WSFE4QkFmOEVCQU1DQTZnd0hRWURWUjBsQkJZd0ZBWUlLd1lCQlFVSEF3SUcKQ0NzR0FRVUZCd01CTUF3R0ExVWRFd0VCL3dRQ01BQXdId1lEVlIwakJCZ3dGb0FVY05PdGd6dHY1MnNDNmZVbwpaY3JpMndiZFk0SXdJUVlEVlIwUkJCb3dHSUlXWkdWbVpXNWtaWEl1ZEhkcGMzUnNiMk5yTG5OMll6QU5CZ2txCmhraUc5dzBCQVFzRkFBT0NBUUVBUjlGdmgwQlI0SkpJcVVUUWJ5bzJzajBtM2NGZ3NhR2R0L2R6VUprdHNIclYKMThpYiswZEZtcXRlRGJHUlZOeWFUOVl2a21OOEROREV0V1FVOXNvWW1JdE1LckxXYUV2U3lxK2xQVGdwdWE0RQpBeklNVmxmWDEzQWdLRWkwaUVkVm5HTU5NSXZTYmRPaU1qUE42dU5UcFVVeURidVZ2QVl0bW84U0VMSWpqRmVTCjNtS1ZpWEphcUh4b1haMlVmc1gwQ3pGWTdGKy8ramUwc0lrbGhzcWZOZEhNdno2a3EzdXhaWnNwNHZaQllPZTkKZkUrNEpSQ0VkNU5xZ3Z4TzliMkZEcDNEWXM5U0UyVFpVZGI5cnVQMjZGYTNveFVUSEpQREwwRUhVWXdrVE1yQwptd1llOEJoSXlNNDBHMzFJc0pvdDFJWEtuNUgwQ1o3TUVnblVNSHFUQWc9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  admission-key.pem: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpQcm9jLVR5cGU6IDQsRU5DUllQVEVECkRFSy1JbmZvOiBBRVMtMjU2LUNCQyxlMWM5YTA3YTBlOGVmNzNmYjEwMmIyNzgyMTk4NzNmYQoKUHc4dkZzRmExRkRpOUVNYlE4Z2QxOTBlUVFEeWU1ZWVZblNISDA5ZUc2eWt3bEM1b2hWcEdtOUtKUXBqKzdFQQpqdUgwNm96STg1TkZtN0V4aGlFZzJ6a1dqVi96RmRpNWk0N0h4QW51cGNJUEFod3k5dDVqRXZEUFZBdUdVSUxhCnJRd3p0UFZpazJBeFFETUovdXN5cDFtOWNrMS8rUmZNc1lTN2pOd0YvK2UyY0p4RmRZQVFmSWExRXdqQzZ5TUcKYWlFMmNZY3B1bWJqaStCamxGaW9qVmtSR1N5bVhwdG5aUVUycW9PYm96YXhvMzltUnhYODdUK0xXclhwMXIrcAo0QTNyUnF1SEMyV2pJRjNURktSc0h2QUgxeGVtSytFb0VvWmVNdWNFRFpSZ05pekNqUXJMSEN3WkZ3UTV1RC9CCjl6ODMwclNEeGU3SmROZGhweVB1a25PdFhYdnhXU3NFd25ERnNXS2w0RXkzaWhtdFJVejRiUStTci9NTkZYaTMKZTFQRlFiTVJ5UTMyOUNmQWwyNExUdHAyWmdjRkZoNVJ6YjR4T0ptOU5yQ0ZQSnhma3JWbFp5cVJFOEc3ZHZiVApXU1R2Q2VYSWJUay9FRTdqd1gzUitCMkFGQVNwK00rQU1IcTZPTXU2ZkR6bTVFbE9QL05sbGl5MVNmYVdKTGtkCjBJNTRNc0grUW9JLzFKZEgxVHkydUFOZDFuZVBXdng0ZGRDc0dZcE1ab3BlZ2FSN043cUw1M0FDRXZxbkdxeGgKSGhqeTgvUFVydWVtS3puRUFVR2RVWC9SSHJvNkxybm8waTIzYjZqN09BQnBLZDUzMXBMWHFiUjV0dk81RjlJSAo2M2VZMXdyRk5jSktzYTdBckZibGNYbDZMWDBYa2UyY1Z1YjNaOEdPSEVsbjFUelVaaG5iZlVzUUxFOXdCdkFhCnVFc0dEbDRybjUzVXc5TEpYWDM2RVFOenEyUVJMRm83TnEyYXF6Nks4b1RON3lRN0hKQnl2WHNPK3RlSk43a0QKVEtKRFJMaFgwQ2FVK1lYaERYMHlYUGpxdTRFSkZURzdLT0d6NWhvMTFWbHprTU83RUoxYVF5d1hHVFBzWDJwcApkbCtkVFFPNXhGSGJpY3MyQllzeUN0YlpxdVdlV0x0SXI4K1JBaHRaMUo3NUVzQlNEVzVjWTVKNnF6TnF1OXV0ClJORHlsTUE4U3ZlaHgrUHl2NzVFdUtKQ0xMbjl4bEkzaWRnWDErQmFwaFBzUjF3S25rd2ZEL3pHUE1EcHVTbzAKbllVeSszRnQvVENZVGZYVXk3NmFxTUVQb1RWVXgyc25HWDBQaXg3TWlGRC8yclpsWjBRYStOcWZSb2pqbXNtRApzRWZCaTFGUWRQekI3NXBvODBCa3FQR0JmNlQ2Q3hvV0RkK0dESnltckRwMFE3TFpaZUNEdERyZE1LeUdTSVZYCnpvT1phZU1QbHpPbEphMGlBTlNXZ0JIMGE2NXpnMTM0Z3I0ZklQNzFsSmtDTnkxMEpIYU9wVE56Q3VxTW1wMFUKbW5hQnVTOFRvdkhUcHV2Tjk1MkpkdUxrUTh5V013ajJ3c25rVzBnY2tRbXlCdVA1ZGFhM1p2YWN5Y1kzWEtBbwpMVUxPWXFodHhoOTRlZDErZ2RzVldLdUNrazE5Um54M2I4aHQ2b1VCNHZtNGZXV2tIMnp0TnY3K1pmUElRNUg3CjFZT3E1SE9iTWRBdm5uUXBlM2hzZlNvOFZRdEdYYU9xS0xEVVZpNTNqc0RxMVJGSUhkOVV6MkRweG5Od1h6VjMKZFRUTURZei80YmhIem81N1N2a05WN1JTbXdnKzk2SkJSNXlJTzJpYy9MLy9zTnU1U045blFIcWt1ZjUwZEIxSQpjemdtTkZ1eWdLdEMwWkRsNXo4d3I3U0FSdWVTVVc2RENuRVcyMGJab3l5SDh0dldwLyt3N2tLWENKK21ab2daClZzcm5wUmJuaFJ5VlhTT1JEMm5neGQwM0FLSlUzVTBWWTMzMWtqRU5FakRLRDBDYXgvYmEraXJjSTFFK2ZEZEMKL1BLckF0TXhON2s0djZFcUNBYmQzQzNrSUN6Z3E2RHJnL21PSkRrandyYmpoWEIzWk9xekJiUEZzT3ROL3RrUQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=

---
apiVersion: v1
kind: ServiceAccount # Service Account is used for managing security context constraints policies in Openshift (SCC)
metadata:
  name: twistlock-service
  namespace: twistlock
secrets:
- name: twistlock-secrets
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: twistlock-defender-ds
  namespace: twistlock
spec:
  selector:
    matchLabels:
      app: twistlock-defender
  template:
    metadata:
      annotations:
        container.apparmor.security.beta.kubernetes.io/twistlock-defender: unconfined
      labels:
        app: twistlock-defender
    spec:
      serviceAccountName: twistlock-service
      restartPolicy: Always
      containers:
      - name: twistlock-defender
        image: registry-auth.twistlock.com/tw_xh82fd7uinul74pwvfiibn09fxe5c6dd/twistlock/defender:defender_30_01_146
        volumeMounts:
        - name: data-folder
          mountPath: "/var/lib/twistlock"
        - name: certificates # Setting the certificates mount after data-folder since it is nested and was overridden in CRI based GKE cluster
          mountPath: "/var/lib/twistlock/certificates"
        - name: docker-sock-folder
          mountPath: "/var/vcap/sys/run/containerd"
        - name: passwd
          mountPath: "/etc/passwd"
          readOnly: true
        - name: syslog-socket
          mountPath: "/dev/log"
        - name: cri-data
          mountPath: /var/lib/containers
        - name: runc-proxy-sock-folder
          mountPath: "/run"
        env:
        - name: WS_ADDRESS
          value: wss://staging-consoles.cloud.twistlock.com:443
        - name: DEFENDER_TYPE
          value: cri
        - name: DEFENDER_LISTENER_TYPE
          value: "none"
        - name: LOG_PROD
          value: "true"
        - name: SYSTEMD_ENABLED
          value: "false"
        - name: DOCKER_CLIENT_ADDRESS
          value: "/var/vcap/sys/run/containerd/containerd.sock"
        - name: DEFENDER_CLUSTER_ID
          value: "e01a694f-52eb-e338-1bbb-eec137062aed"
        - name: DEFENDER_CLUSTER
          value: ""
        - name: MONITOR_SERVICE_ACCOUNTS
          value: "true"
        - name: MONITOR_ISTIO
          value: "false"
        - name: COLLECT_POD_LABELS
          value: "false"
        - name: INSTALL_BUNDLE
          value: "eyJzZWNyZXRzIjp7fSwiZ2xvYmFsUHJveHlPcHQiOnsiaHR0cFByb3h5IjoiIiwibm9Qcm94eSI6IiIsImNhIjoiIiwidXNlciI6IiIsInBhc3N3b3JkIjp7ImVuY3J5cHRlZCI6IiJ9fSwiY3VzdG9tZXJJRCI6InBhbnctYXBwLXNhbTEwMzIzMy0zIiwiYXBpS2V5Ijoib3BZSnViZmt0N3N3ci93VDJCaWNNOUMwdW9lSzlDa3pxVERmYm4wS2ZuQndvVGFaTW03Q2EzZE13K3ZjWVUrYWp6VS9RZjdWcjhuV2E3dkpNT0dqRVE9PSIsIm1pY3Jvc2VnQ29tcGF0aWJsZSI6ZmFsc2V9"
        - name: HOST_CUSTOM_COMPLIANCE_ENABLED
          value: "true"
        - name: CLOUD_HOSTNAME_ENABLED
          value: "false"
        - name: FIPS_ENABLED
          value: "false"
        securityContext:
          readOnlyRootFilesystem: true
          privileged: false
          capabilities:
            add:
            - NET_ADMIN  # Required for process monitoring
            - NET_RAW    # Required for iptables (CNNF, runtime DNS, WAAS). See: https://bugzilla.redhat.com/show_bug.cgi?id=1895032
            - SYS_ADMIN  # Required for filesystem monitoring
            - SYS_PTRACE # Required for local audit monitoring
            - SYS_CHROOT # Required for changing mount namespace using setns
            - MKNOD      # A capability to create special files using mknod(2), used by docker-less registry scanning
            - SETFCAP    # A capability to set file capabilities, used by docker-less registry scanning
            - IPC_LOCK   # Required for perf events monitoring, allowing to ignore memory lock limits
        resources: # See: https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#how-pods-with-resource-requests-are-scheduled
          limits:
            memory: "512Mi"
            cpu: "900m"
          requests:
            cpu: "256m"
      volumes:
      - name: certificates
        secret:
          secretName: twistlock-secrets
          defaultMode: 256
      - name: syslog-socket
        hostPath:
          path: "/dev/log"
      - name: data-folder
        hostPath:
          path: "/var/lib/twistlock"
      - name: passwd
        hostPath:
          path: "/etc/passwd"
      - name: docker-sock-folder
        hostPath:
          path: "/var/vcap/sys/run/containerd"
      - name: cri-data
        hostPath:
          path: /var/lib/containers
      - name: runc-proxy-sock-folder
        hostPath:
          path: "/run"
      hostPID: true
      hostNetwork: true
      dnsPolicy: ClusterFirstWithHostNet
---
apiVersion: v1
kind: Service # Expose the Defender as admission controller. Remark: by default, Defender will not listen on the service port
metadata:
  name: defender
  namespace: twistlock
  labels:
    app: twistlock-defender
spec:
  ports:
  - port: 443
    targetPort: 9998
  selector:
    app: twistlock-defender