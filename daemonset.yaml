
---

---

---
apiVersion: v1
kind: Secret
metadata:
  name: twistlock-secrets
  namespace: twistlock
type: Opaque
data:
  service-parameter: SU9tQytuMm51dU1nU2hlL1BpYWZBMUxYZlB3WVA1MUZ3SUxsNytoK1dzNmxjdDBWc0txZmp3djZsL0w5SUFZTjBkQUFGWkJMNFpGR2JsY2dUcFBnUHc9PQ==
  defender-ca.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURIVENDQWdXZ0F3SUJBZ0lSQU8zWnlwK2FUclo1RGJvUDFPN1ZKQlF3RFFZSktvWklodmNOQVFFTEJRQXcKS0RFU01CQUdBMVVFQ2hNSlZIZHBjM1JzYjJOck1SSXdFQVlEVlFRREV3bFVkMmx6ZEd4dlkyc3dIaGNOTWpJeApNREU1TVRVeU1UQXdXaGNOTWpVeE1ERTRNVFV5TVRBd1dqQW9NUkl3RUFZRFZRUUtFd2xVZDJsemRHeHZZMnN4CkVqQVFCZ05WQkFNVENWUjNhWE4wYkc5amF6Q0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0MKZ2dFQkFMVXFRc3FXb3VlZ2hiMnJkSlVlRTVxakFQRHlrT2owTG1VaVk1VlpNYUdFbnVNamNCcGF5VHd0VjAvbgpWY0huQ0NzR3NuYlMyZlZjcE0rSkRZakxxOUUyK1JCLzI4c3EzcEJFcmJBbjlKMitWZ0dnVjNuMUxQV1dlaEtUCmwxYXFpSWp4Ry90b0hkbVB5QzBUS05YSTgrNkZhK2hJVUFLQVFlSExUa2R6UWxPZGs1UWpid3I4UWlJQjFzWncKKy8yUHBmcTBjSHRLMzNFQzIrVzFqR0tKTnZNMkJnbk4rMUNEZytGSHU3RnpJbVFPbTJVYnArSncwemZzTDBYRgpiUTFCMHFLZ21oNzNrYmxGUkorc0dDdWcxcjdlNGJGU2p5S1hGVGJUeTBsSno3bkwxR2ZZTER2YlpjS1RyN0gvCk11VjY4Y0Z0MjlHSDZJMGE5ZEZhMGR6MCtZTUNBd0VBQWFOQ01FQXdEZ1lEVlIwUEFRSC9CQVFEQWdLc01BOEcKQTFVZEV3RUIvd1FGTUFNQkFmOHdIUVlEVlIwT0JCWUVGR0d6U0R5Vll1Z3ptSGorWnRDMllYUzdubktrTUEwRwpDU3FHU0liM0RRRUJDd1VBQTRJQkFRQTNmMnE3cDMwZmxOQ21GYjZmZXh4MG9Cc09BazU0d2RGQ05kMjZmenRMCmd3QmRCTUN0WFNTM3JHQVJIa3NlSzYrVUhlWXEyU0tkUzg4bWRTM3h5c2VnVzdGak8zSkIzNFp2ekFtYmFOMlgKbzgzb3lwaFNrRWVBRXRha1lOVmROWXpiRkZnd3pmd0Y4TjREbmVBRWh0V2ZwRkp0TDkwNHc4c1JZdHd5S1J1RwpyYUtuT3B0L2lPRGJ6WVJJYWpLdGgwSUMraEdXa1JPbTZacWhDNHFDRGJMaVMwSlp4bUJRblhQTlJsc05aUjllCnd2dTdTaXdIV3BDMDkyaUhhK3g0NzBNN0MwT1dLR0hqcEJGeGoyVEFhaFk2L2lyZHBuLzZYSTg5enJkQitqSXgKbDE1cEx0Zm93empSY0pzZTBsS3FHa3NkSnlHNDFNN2gycVZQcHovSTVFNDUKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  defender-client-cert.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURQRENDQWlTZ0F3SUJBZ0lSQUpxbjNpcUhWVnZsMjUxOVdHWXdjOHd3RFFZSktvWklodmNOQVFFTEJRQXcKS0RFU01CQUdBMVVFQ2hNSlZIZHBjM1JzYjJOck1SSXdFQVlEVlFRREV3bFVkMmx6ZEd4dlkyc3dIaGNOTWpJeApNVEUyTURZME5UQXdXaGNOTWpVeE1URTFNRFkwTlRBd1dqQW9NUkl3RUFZRFZRUUtFd2xVZDJsemRHeHZZMnN4CkVqQVFCZ05WQkFNVENXeHZZMkZzYUc5emREQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0MKZ2dFQkFMZDdLb1ZOWkpQVTVscnljdk5haXNTcmlBdWhoNmlUSGlmamIyZVhXUi8vYzE2ZXFqdzR4NlZFc3lCTwprSUREeDlOajBLVllUOE1DT24xN3U0VFVGK2RXTUMwemFnNGxXVjlpb1A1TjFxRjc0OGQ4S2draXBDcVBZR3RYClE4TFBpVE11YkhoanoyTytBY1B2UmJFWVg1cFlVeXNNeDc3aGJRRnpCbEUxVzdSWGpmWFpxS3lOM0MxTVhmL1cKYnJOdzVMTldyWHV0cWh6MkZocU5VOXEyOS9zZWVoRnRhMlpqZlJablZheVNGTEpVcTY0SjhLeURKYmxrTmRKcgpGWlFHT2NnTDR2ZkprSHRJR1dueXFpUXFpdVVpYmVRbnYwbitxMEUxaVpNYkxuenZJQ21CMSt0bXRwOCtOMFAzCjQ5VUdtQjBRWmUzMjJLZzJjYUIxYXYrYk85c0NBd0VBQWFOaE1GOHdEZ1lEVlIwUEFRSC9CQVFEQWdlQU1CTUcKQTFVZEpRUU1NQW9HQ0NzR0FRVUZCd01DTUF3R0ExVWRFd0VCL3dRQ01BQXdId1lEVlIwakJCZ3dGb0FVWWJOSQpQSlZpNkRPWWVQNW0wTFpoZEx1ZWNxUXdDUVlGS2dRQkFnY0VBREFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBClpJL0RzS092bnJiZDQrZU9IQkJzM1lHWC9tWThUSkJwbzBod2lXYVdSTmd6ZTh4eHNiemdzQVo1QUk5TXNNemEKcDZ4ejRKbUlXOTl4cWNZVTkvUm10Nm9JcVJZWGVodE1vTnV3RG13T1hmb05zZzVmVVBRcGVwVEVJYmp1RVlvNgpEc1hBVlVrVjlVQWZsWjlhMGQ3NGVScG4wT3Jqa0k0RjlMcFhPRXM4aDRRd2piTHIxaEdWakFaaklDS1c4VHRrClNMM25rdmM2SllIZU9jeTYzcXZWb3F2TU9MQ3BkanJ0S0lUOXBTVVVDdUJsNFZXV0h5Y0NwbFZzNDg2dmIxdGwKTXBsTW9uYnFUcTlEbDVUc3J1aWtJMWRGZjR0MzdWWWkrcEF3SXVlekpuL095Yi9FelJwL2l3NzNiZ3B2eGxHagpIak5wUEVBSTBkcUVBSHZsVWh5RTRBPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  defender-client-key.pem: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpQcm9jLVR5cGU6IDQsRU5DUllQVEVECkRFSy1JbmZvOiBBRVMtMjU2LUNCQywxODI2NmNmZWI3OWZiMDJkYzE4MDc2ZmZiMjRlMmNmNQoKTElOZFpGNWpZalJkVkdiSC85Zm9vQTZ5QzdIanN0Rm5GZzYrTmRZNllVNm5lbGY0WmRiRExDV2pENTluOVFoOApoVktjcm92Yyt3UGFheFQ2R3BJSEtQSllFbG1SeWk3cG1UbWU4NkhBUXB6NTRVQ1pmcW1sME9vRkZzbFlJUjNvCkpTdk1hcVBCYTFiS3dsVEZHV2d5aVA3OGU4NVhpaDZ4SkdPelF0QWI3OCtvZ3VxbldYakwxb1REa0pZMERyZ0wKSEdoQnBSeE9aQ2lGUFd4eE10V0RpWTNDc0V3WlNpMEliZFBXYk1McmxsTk1sVWtrLzl3UE1QU1dCZklQd0d0bApvVjE3WFdVWlVDLzhwOVpyUGo5SEVBMFJvZXVCTXhSbk5LYnhCRFM2cWpwZ3JVRVRlL01LSG1MOUViencvSHYzCmZJekZJOFlHZDNURFhnM1lEQk9zb0Z5OEx0N3lLY0N6S0NtbnBVSURTeHA4V3FxSW5KT0VORm45d1BFYTk2bGMKeFU5NkFDZWlFK0YvbjlwKzYzdUxmVmF4OTQ3ZC9GSHNrU3A4Qys1OEtKQVRCbHZUQThqZFZLVGJ1RUt5VHNnSgpOWVNpTW1DSnkrVVJrdkpZRXFyb1RsMmtPSnVXam5LSWtDQ2lDdGY4bG9UeDhYWHhwWE5RTzhJemZnazNlMzBBCk9xRWNaZ25GSVFwTG5ITGZWZ3ZCaEtlVm42YUhPTHduNmJadG0rUXptdFUwZEdIZnlKbks1YzVHenFiRlVyZUUKUmMweDZ3M0E2a21YcTU3VStDSDhUVS9QakJsckoxOVZ4ajN5M1RORUY1SmVoNkYwSWJmQnlVNS82dmc5dVJ1MwpUdlBGWUwrTmh4aW00RkVjS2tIMnIzTmpsYlZQU05KeTNONENOZUxFQ1VSUmUyVjQyQ0hJWWtqNTluV1d3TXA3CkNpNjgvR29xdk1jQ3ZzdTNiRzB5QmFVbmJmNytFdFJzT1lyL0pGV3B4TVJOUFV1WXJWYnBieWJUZUhlWVB4aVkKakxmaHBBUHAwUUUrNllDMk51KzYwMW9kTEJjUlowcUJrZGF4WXdlQzRwRC9yV2F1SmgyVGM4MmlPVGFNK0x1MQozVFd2UDhma0RibG84SVorcXlGVnpzVDRZTHprL3liblBBenkwSDYvaXA1UnNjMlUvNHV4eHJ4QVUzMWNXMHExCnlMN3h3YzFVcnVPSGowSjFSbndDa3gxeXlaNDVaSncrbGV4TnVxbWNZUGppSk41TFdacjFlaDZFTjhXSWQxTEoKb0J1cENLcEVJaTZINjFJa2RhNm9aQThQTnd0TUExRE5EbjBtV0ZsY0R2bW01bGlIR05rM1MrU0Q5R25tQ0F2ZgpBcjVJNFpQV2VKdjZyQlVjN1NwV20vY2dkUm9rMzZlSnVzT0ttaVN1RjV3dTVUYU9GZjFlcmY2Y0h6dkYybnhjCit6U1JicmkzTGFneG5ROUtxYVJGbFNIdGZUSE9zNWNzc3RGa2N4Um11TWQvNUs3R0xoazZDbU91NlB0VlBHUlIKc1lYTG1FVUxEYWtpSWxpT2loY0NDK3djSmVrOVFHbTFQaGxLTTZyeGl0V1FvYUYvSmoxNE9pMEU0N0pualhITgpqNUdwamhxd3hzMkhER3pLeHN2b0FvNUVWaW1Qb0liZmdpK3NBVUhGK0h3LzMwL1ZzbmRSaTZiMk90eHQ1UERkCnJSbWtZVllYT08zVFJkdkpPRnoxVXlwQzZwbHRxblhyeVFIS0ZjTU1NRU01TGZtUk11N1NCMmY4aVNRdCttNEoKZ3hlcGVYU2ozM0JWUUNvQXV6Yjg3dWE0ZFh2empWakNNR2xUQ0ltMnZBeHllekx6RVZmM0toclRnT3p1OFN4aQpkMlYyT2J4amg5MndrOC9hQysrUjJUUWJCeThvSmZ5VmFaUndTNFJzYTZTZnpsc3ZhWHBBV3IvbjFQQjFvY3VWCkptdXdWdU5XN3BTZmRaUFNuNW9lS29JaG91TXIzQTR0WGlFSVdlZnNlN3JuNHViaE8zMnNkSFk4QkVCUXZmTmUKSllVbHdQVzU1a1hXcDhrMUVBYklITmxNRTB5RDMvT1hhMzBUN2xXS0VQSkt3ZDZyUVYwOG1ITkw5bTV4TkVINAotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
  admission-cert.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURTekNDQWpPZ0F3SUJBZ0lRYTNDSCtJR2k2Ylk1a3NlZDZDUDNOREFOQmdrcWhraUc5dzBCQVFzRkFEQW8KTVJJd0VBWURWUVFLRXdsVWQybHpkR3h2WTJzeEVqQVFCZ05WQkFNVENWUjNhWE4wYkc5amF6QWVGdzB5TWpFeApNVFl3T1RRek1EQmFGdzB5TlRFeE1UVXdPVFF6TURCYU1CUXhFakFRQmdOVkJBb1RDVlIzYVhOMGJHOWphekNDCkFTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBS1RkWWc5K1RwLzVDWnlEM2xUM0JiaEsKb1dMYk9kSkhSNDJsVStOOHBuMXhjU012aUlhdTBwK00zWHc2Tm5kYStIRU9tVGNycGpVVUZRYWx4b2VmTUdzVwp3bnplYjNuNU1jL0tOZ1NwV1BETWNGOTRMRE1xc3ZDREMwTXFQazBMQ2lZZGkzcmJGY2ZIUmFlZVZhcmNwc1NiCjFFQVVuc0ljUFNyYnlDWjBOdkpxSWlrbHBmUGl5UDJwdzRDSzdwMWhIYjlHZnU0ZFZ1c3NmZmc2RE5OdytncDMKUVNnbnp5bWQ3b0N0eWczNGVGNURjRUY0bmZWR3JGYUIxMERUK1lBMDVtMXdvR1pEVzRpMWw1OCtlMjMrWVB6UwpUeVgvc2Zya0hvb2E0NG56Tkp5Sm0xMkcvc05ESlYzWkpuOWpOT0UwbzFRM0dPNXpWUWxMQXd6dDVqdmtXZlVDCkF3RUFBYU9CaERDQmdUQU9CZ05WSFE4QkFmOEVCQU1DQTZnd0hRWURWUjBsQkJZd0ZBWUlLd1lCQlFVSEF3SUcKQ0NzR0FRVUZCd01CTUF3R0ExVWRFd0VCL3dRQ01BQXdId1lEVlIwakJCZ3dGb0FVWWJOSVBKVmk2RE9ZZVA1bQowTFpoZEx1ZWNxUXdJUVlEVlIwUkJCb3dHSUlXWkdWbVpXNWtaWEl1ZEhkcGMzUnNiMk5yTG5OMll6QU5CZ2txCmhraUc5dzBCQVFzRkFBT0NBUUVBWWIxa3lqRnZOMjZSREYxRStJOGp3MmpwUmZNOGpHY0ViU1YxZ0hPYll1QmIKRElIeU9QRy8xTnc5QkNxSnFmVG5KNjUrOUpKekc4RW1Dd1p6K2lYbytxaHp3ZkNkYUJpZGcxWTl1OXpoU21QYQpCSlRNTTZLYW9ZUDcwV291RGRpQ0pkOHlOUXBaTmFLdHpjYjNVQms5SzliM0prbzZaRWh5aCtxd3FGY3JqOWxGCmc3clNIenFhNnZDOFJMMkVCejZUUGlRd1QrYTY3d2piYnZBV0U0SjlLREdPNUFMMTJhZ0ZoYk1qc1ZOVFkzcG8Kd0tSVFI3Z1dGMkE4NWl3UmhCdm5xWkJ3cWVLREo4ZWF5c05BNHV6MkN6UzIydG52d0JBNTNoL2M1SkhNOFVCUAo4cWJBdE5wQlhlSTVVVHJkU2d3bkh0dGpPaFYyQXgwRDNSeU0zSHVoOXc9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  admission-key.pem: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpQcm9jLVR5cGU6IDQsRU5DUllQVEVECkRFSy1JbmZvOiBBRVMtMjU2LUNCQyxiYTA5YWVjYTVhNTQxOGJmYWVlNDcxNTlmMjMxYzdjZgoKdTllM2J6UmhycWptMXhIVnFIY0hLZktYZTBGV3dEY1FFQ0taTWh2empwdDkvR2FRNHZsQXlmc1BNdzR5TTNlVQo5dTRqV3lkbTQzalZhUnhYVjNXcHJMelpTWHZqK042aVZnb1pYNWtBdUp1QXZiY0NLcnZ2U1l2dE5KZFBKYjVuCjdIT1UxS2U5NkhpenpxbUdMemNGOTZJaDJGM1huNlRFUlNkaFc2THJiQjFvMjFlUElaaTdhbUNIcEwzV2F6emQKRVZsUlljT2RkSUV3TkJUTUxWRUFsU0l1Y0QxZDRuWjNaN2pER3ZyQWdWT1N1MklVQUZoU0NTbmZ0dWpKR1REYgpieFd2U1luaTZNWUlNZ1R5eHhvcnpmZUt6MUx5c2svY2VXdFhoMEhLWHV0N3NhNG1IY3BwalFHWnY4QnhsZVJHCmhTMG9KR0lKeW9Bb3pzdjZPcHU5WkFLWGFTcW9SUjZYVzdxZkh3dVV0dWZtZ2FEZHN5Z0YwQUpvZ0oyRVp3eGwKbEIya3ZnajJENCtQQ0c4WjdUeWZaNXRUdUE2a1BqbUp3bXpCUVJmaWtvQXQwR3MzWFplUEoxak9ESDRkRm41MQp5V0RiK1BxVnlvblZCMnUzOHBLblQ2aFZIN3haNFpHVGZ2T2tLVW1abFFCd294TTQxa0FTK1ArU0F5VlREVWd3CjAyZldJdTVwTXluTThIYjBncFBSSjdXSDE5SjJ6aTNJWVRTNnIwVWxXV0YxaFd6eno2RDJ4RUVCZGVndjl1SkgKOXhQV2JVa2Nka2pZWStOL3cwWko5d2dTRGREK0hNVStHNGhVRDljbkdDOHQvWUV5ZEpuMWhJMDFwZWtOdUx6dApLZkNuSGNqblJVU0YxemZpSUtiTTl5ejJQQzdoSVpDMWgyc3pIanROVVV4Yy9CVWZoUi9od0c2VmpnWFQ4S0tlCjk0bHZkblN4VStmUlFoSVAyTzdqVDJ2UUR1bE9qVUtPNUxUREY4MDV5TzFWd1d3ZWM4M2EveEhycEc2dnNrS2MKQzJFWVFaOXF2QnpmMDlKWnRpMnp3K20yTHdGRFRWQlVaVDlkdDEzKzZDQWdrMmNrWElxYUQ2dGIzandFa3MyQQprKy83cE4rcWRLMG8yNGg4UExVd01sMlFEUXdRbWVrMzVYalI5bmtKMFBGTFNHQlhRMlNIekd2TmMrc0E2MWxxClBPc21qcjFKYzNFT0hjRHpVN1A0aDZjUmp2UEx2dlE1U1pPVDhkU1NkNVd0ejNHakNJbXVHQUE0MnZvYmJ2engKSGV1NHQ2czVRc1FXWWVBMkVYSW9rTEx6SzRBTnd4WGZ2dGxDYkM5YWpEd3VVTzdORTB1Y3pjb3pKMGkxUlhjbAo4SGtyMjMvbTc1d0tCZFdIRWxFOWxhQU5hajdpVGJweWQ4TU9YZFkvbEdQY3FROFV1ZGw3cmxoTEVpNTJ1TDBmClpuYVN1Njd5R2pZQmtYT0xxSDFaN2VaNE5GUVgrekNsQ3VIZFVuSHdNZ0l1aWlsQlIxd2RGaVByMk4yN3N6N1MKY1duMEkyNm5CV0JXdDJFV1ltbXkycW53U2x3ZndmK2xDTkQ1aXcySUZOcFRpdzR3bVFTQXVWRGtCV215UlJ2MQpmTDBEYXFHdzM2Z0JFR3FmR2RXOWg4dzk3aERYVEtJMjhjMEZ2R2lrQU5sQ21yVi9SY0lXRXZNOHI1cVlYYkNCCmx6YVRKYkRPdmd4UXd0Y29QcERKU2VKWWVQKzZnTExzMkJGREdhL0t2aFZUZEE4QlFQVm1oa050U3B3Z3pOSjQKYlZFZHUxdGlzT2FhWkdtZDl6ZFZwOXk3UFBlaHBOSVRHOGZzOG96K3JtRC9lU0dac3F5MnQvaHFXN2d4ak5RdwpVNFRRM1RhNXllTUZGMmc1RitFNE9tWldsYUoyc3RuQjIzamtjK2tISUsxQVhhSTdhM0t3cU83WkxjQW52QXpvCnA2Zm5rL3J3UHdKVEdaM2k3WUxUYTFJaURiUGhUL0NxUENFUEtRNnVmNHpaZ0dPTHJKSEtRRllhcUhpbEZyc1gKaHdCUzBzZkJtc1JmQ1lpeHFQWFMrK2JhVDFBT2hCcFRzdHkxOXpvQjRiY1J4U0hUSHZTblNGREgxbk1iOEczMgotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=

---
apiVersion: v1
kind: ServiceAccount # Service Account is used for managing security context constraints policies in Openshift (SCC)
metadata:
  name: twistlock-service
  namespace: twistlock
secrets:
- name: twistlock-secrets
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: twistlock-defender-ds
  namespace: twistlock
spec:
  selector:
    matchLabels:
      app: twistlock-defender
  template:
    metadata:
      annotations:
        container.apparmor.security.beta.kubernetes.io/twistlock-defender: unconfined
      labels:
        app: twistlock-defender
    spec:
      serviceAccountName: twistlock-service
      restartPolicy: Always
      containers:
      - name: twistlock-defender
        image: registry-auth.twistlock.com/tw_xh82fd7uinul74pwvfiibn09fxe5c6dd/twistlock/defender:defender_22_11_390
        volumeMounts:
        - name: data-folder
          mountPath: "/var/lib/twistlock"
        - name: certificates # Setting the certificates mount after data-folder since it is nested and was overridden in CRI based GKE cluster
          mountPath: "/var/lib/twistlock/certificates"
        - name: docker-sock-folder
          mountPath: "/var/vcap/sys/run/containerd"
        - name: passwd
          mountPath: "/etc/passwd"
          readOnly: true
        - name: syslog-socket
          mountPath: "/dev/log"
        - name: cri-data
          mountPath: /var/lib/containers
        - name: runc-proxy-sock-folder
          mountPath: "/run"
        env:
        - name: WS_ADDRESS
          value: wss://staging-consoles.cloud.twistlock.com:443
        - name: DEFENDER_TYPE
          value: cri
        - name: DEFENDER_LISTENER_TYPE
          value: "none"
        - name: LOG_PROD
          value: "true"
        - name: SYSTEMD_ENABLED
          value: "false"
        - name: DOCKER_CLIENT_ADDRESS
          value: "/var/vcap/sys/run/containerd/containerd.sock"
        - name: DEFENDER_CLUSTER_ID
          value: "fe0c4a93-9bf8-0fec-80c2-94ec816407c7"
        - name: DEFENDER_CLUSTER
          value: "tkgm-carlos-photon"
        - name: MONITOR_SERVICE_ACCOUNTS
          value: "false"
        - name: MONITOR_ISTIO
          value: "false"
        - name: COLLECT_POD_LABELS
          value: "false"
        - name: INSTALL_BUNDLE
          value: "eyJzZWNyZXRzIjp7fSwiZ2xvYmFsUHJveHlPcHQiOnsiaHR0cFByb3h5IjoiIiwibm9Qcm94eSI6IiIsImNhIjoiIiwidXNlciI6IiIsInBhc3N3b3JkIjp7ImVuY3J5cHRlZCI6IiJ9fSwiY3VzdG9tZXJJRCI6InBhbnctdHdwZXJmLWRldi0xIiwiYXBpS2V5IjoiVGJ1M1NrQTd5cmhjWEJadjgvQTZhSzFMdFhSQjRTeEpDRlNDL0FqV1VkVU12dGVhSVgxSFp0WXQ2Z0kvNVVJc2xCNVFxVUo4UWthNzhwVFl4eGh5Q0E9PSIsIm1pY3Jvc2VnQ29tcGF0aWJsZSI6ZmFsc2V9"
        - name: HOST_CUSTOM_COMPLIANCE_ENABLED
          value: "true"
        - name: CLOUD_HOSTNAME_ENABLED
          value: "false"
        - name: FIPS_ENABLED
          value: "false"
        securityContext:
          readOnlyRootFilesystem: true
          privileged: false
          capabilities:
            add:
            - NET_ADMIN  # Required for process monitoring
            - NET_RAW    # Required for iptables (CNNF, runtime DNS, WAAS). See: https://bugzilla.redhat.com/show_bug.cgi?id=1895032
            - SYS_ADMIN  # Required for filesystem monitoring
            - SYS_PTRACE # Required for local audit monitoring
            - SYS_CHROOT # Required for changing mount namespace using setns
            - MKNOD      # A capability to create special files using mknod(2), used by docker-less registry scanning
            - SETFCAP    # A capability to set file capabilities, used by docker-less registry scanning
            - IPC_LOCK   # Required for perf events monitoring, allowing to ignore memory lock limits
        resources: # See: https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#how-pods-with-resource-requests-are-scheduled
          limits:
            memory: "512Mi"
            cpu: "900m"
          requests:
            cpu: "256m"
      volumes:
      - name: certificates
        secret:
          secretName: twistlock-secrets
          defaultMode: 256
      - name: syslog-socket
        hostPath:
          path: "/dev/log"
      - name: data-folder
        hostPath:
          path: "/var/lib/twistlock"
      - name: passwd
        hostPath:
          path: "/etc/passwd"
      - name: docker-sock-folder
        hostPath:
          path: "/var/vcap/sys/run/containerd"
      - name: cri-data
        hostPath:
          path: /var/lib/containers
      - name: runc-proxy-sock-folder
        hostPath:
          path: "/run"
      hostPID: true
      hostNetwork: true
      dnsPolicy: ClusterFirstWithHostNet
---
apiVersion: v1
kind: Service # Expose the Defender as admission controller. Remark: by default, Defender will not listen on the service port
metadata:
  name: defender
  namespace: twistlock
  labels:
    app: twistlock-defender
spec:
  ports:
  - port: 443
    targetPort: 9998
  selector:
    app: twistlock-defender