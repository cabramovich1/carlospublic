
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: twistlock-view
rules:
- apiGroups: ["rbac.authorization.k8s.io"]
  resources: ["roles", "rolebindings", "clusterroles", "clusterrolebindings"] # Allow Defenders to list RBAC resources
  verbs: ["list"]
---

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: twistlock-view-binding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: twistlock-view
subjects:
- apiGroup:
  kind: ServiceAccount
  name: twistlock-service
  namespace: twistlock
---

---
apiVersion: v1
kind: Secret
metadata:
  name: twistlock-secrets
  namespace: twistlock
type: Opaque
data:
  service-parameter: UkR6OTNrN1ZkLzdBWlZGNll4dGlYbDgwb1JhQWJpMytvRkdEWjIvT3VaRDk1R0Y3eUdMOTlseFNoWm5KQkVlVWdBMnhPNnZSQzJ2eGdCY2pBeG5mcnc9PQ==
  defender-ca.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURIVENDQWdXZ0F3SUJBZ0lSQU9ZSnFKdUg5MkRlbG9UTGYwUnRWMUV3RFFZSktvWklodmNOQVFFTEJRQXcKS0RFU01CQUdBMVVFQ2hNSlZIZHBjM1JzYjJOck1SSXdFQVlEVlFRREV3bFVkMmx6ZEd4dlkyc3dIaGNOTWpRdwpNakV5TURZMU1EQXdXaGNOTWpjd01qRXhNRFkxTURBd1dqQW9NUkl3RUFZRFZRUUtFd2xVZDJsemRHeHZZMnN4CkVqQVFCZ05WQkFNVENWUjNhWE4wYkc5amF6Q0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0MKZ2dFQkFNazRSTnc0aGMreU9nZFNMNlIySm4rbktWeTJkL05TMGtObjJPVERydjdFU3hFejN2TFlMQkNMZXorbgpIZ01yS05rdi8xQmp0UzZ4bzNtbnRiZVpEbThRS0FISkUxV3oyMG1TT29JQ1FIWndQV0YzMEMzYm02K0FLNnJaCllMb0NBMWNZb2kzanZTMW5QbEk3WUVldkNXOXdkcnVsb3lnMk9aWXBvU3FudUppbU4xUWZlaTN3K3NZbnQ3MDkKMnZnMFk5NmRKQ2tGdGFDcFdlQWVZeXVIa0Y0VDNwdmFDeldKejV4bEpHY2gxRXk3UmlaOVEvaTlPdFNOZ2NFbQowc3pWcXFSQjhoNmoxSUZZZlZtVU1uQTN0VnV1OTAzdlFuTG9FV2FVbWdWR3c4VVA4ZlJjdkMvbmRNS2RHbU5RCi9LN0xGa1p1S0tOUTNOS3Zvb1Y2VGRUc1F0MENBd0VBQWFOQ01FQXdEZ1lEVlIwUEFRSC9CQVFEQWdLc01BOEcKQTFVZEV3RUIvd1FGTUFNQkFmOHdIUVlEVlIwT0JCWUVGRlJ0ZEhtcGVFczY3L3dNdEFnMGRnQ2V2QlN1TUEwRwpDU3FHU0liM0RRRUJDd1VBQTRJQkFRQnM2OEt3d25SOUJEdFF4VFA4SFdCTStQdUIySHVoQVBkNUV0Q0laSGluCnQwOUZZbmZIWUZTODdLYXNmUk5ieCt3WjdGUXBsUGx3eTVINkx2Um9IOVJ4amVVLzVtVG9wWXBEWGRFeVo5Y04Kb0ZVVnRWaUIvS1YreTlIMW5La2NHSGpDUmc3emdLUHNORGw5N0RGc01EWVlpblZrejhXb1NpdlljWUR1aHZQSApSMEhxMkpaNGVyMW9lazd1YTQrNytieGxQV3NEOGVlQzdiTUlOTTVETmVjWWJ6TGVTQXhqRWQ2TkJNMVRmT3pOCnBUTGtubXZTZ3RaM2xDeFdxSmZFelQrNzZmV0NFVjNNMUx2ZTZScVdNN3NoNlY2RklkbTUzaC9mdEV5amYrWjIKc1ZMcFl3YkZnR01oZlpnZVNheDV4bFd1Ri9KY1Z1Tm15WXZOK0wrUFBrbXEKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  defender-client-cert.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURQRENDQWlTZ0F3SUJBZ0lSQUl1aU43Qyt4ZmVvdzlGeWpwRUJkRGN3RFFZSktvWklodmNOQVFFTEJRQXcKS0RFU01CQUdBMVVFQ2hNSlZIZHBjM1JzYjJOck1SSXdFQVlEVlFRREV3bFVkMmx6ZEd4dlkyc3dIaGNOTWpRdwpNakV5TURZMU1EQXdXaGNOTWpjd01qRXhNRFkxTURBd1dqQW9NUkl3RUFZRFZRUUtFd2xVZDJsemRHeHZZMnN4CkVqQVFCZ05WQkFNVENXeHZZMkZzYUc5emREQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0MKZ2dFQkFPbC93ZnRSTmRua3FUZzE0eWFROW9TMjkvWmtyU0pNOTlvcEtDMTFrZXlSQjVYWk01NXpLdWdhTXJvSwpLZGsyT2FxcUhmVDhPcCtRbURJOUhGbmpxMHdiZ296NGUxRW53ZnlSa0lTdUtpWDNuYkNyK0VoeVNobFFkbk82Cms1WStxeVNCTnVtRk5WWHAra3gyRWhTaHhlb1o5cFpHN2tpZE43dDhnanlrYVdzZ0JjTG9IWThsWllNUWY2RjgKVlpzT0FiRzdrYmlZeEYvVS8rM2ErcVczc2Fha2FUckxTc3ZsNnV0Ti9lZXc2R2Q5ZUlUeHNNTGp5a3NFZFJIYgpjM0JCMEF0dHExRW1vOTF3dHg5d1Q4MCtxRGVsa2tsV25GajBCajBVZVdzaXMzUDEydjVyeGxGZXNMZWRKVHdyCitlNXFqNGFDdTk4TG5QL04yNnVTUk9yaUEzTUNBd0VBQWFOaE1GOHdEZ1lEVlIwUEFRSC9CQVFEQWdlQU1CTUcKQTFVZEpRUU1NQW9HQ0NzR0FRVUZCd01DTUF3R0ExVWRFd0VCL3dRQ01BQXdId1lEVlIwakJCZ3dGb0FVVkcxMAplYWw0U3pydi9BeTBDRFIyQUo2OEZLNHdDUVlGS2dRQkFnY0VBREFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBCkg5NmRkaXptZnMyS3h4cTBzS3F0YU1kNFZ1cXVMQ0preDVldHpGTTYvRGlwTU1tYU5RTGs3QkRGT2JPZzlUa1EKckQ0K2xuMFJCTlpicmFneXBkaStYUnJkNXdqT2ptN0l6aDIxbkVSYXdwVFlCSmRET0c5RWk4T2N0NmczR0xPUwpNSDVzUmkxN1VuaHEzZFFWOG4yRVVsOU1VVUZqZHdUTm9NNStadFhob3hLZjM4d2ZicmYzUXdqT1J2OC9oMmxkClQ0MzlUN0ZZMVRqSTVoUEFINkI0Y0xBNFBpVDdWYmVuMjJZdVZTWTl6c3VwVGJhMFVQY0JUSFFza1A0VzkwRkYKY0ZuVU1Dd2hZU2ZDREF4blpOeE9KTkErampOZjJWbGZoTWpoSC83QTByY3NqRm5PSUVnVzNnTjFDSEUzamFNKwoyY3FxS2FJMlIyYUlmYXlxVjZ5SGlnPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  defender-client-key.pem: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpQcm9jLVR5cGU6IDQsRU5DUllQVEVECkRFSy1JbmZvOiBBRVMtMjU2LUNCQyxhMjUwMzZkYzI2ZjVkNzgxNjI1MjY3MzUwNTY3YTE0YwoKRnBKSjhuL2VCa0J2Ykl2ZzZCQ2Nab0Z0MThMZ0VTOGxqTERZWVlMTVdHM0dnWnFWcHJUdEgxR2F6WTIzQmFPLwoyNzVobkZ0S2tKUmNqdXVMNGVvNUozcnQ4UGUzRWZpNTNsak9EUnlBQzlSeDdBaS96MG4xM0I1SGZyOVFtb0RkCjlEQ1RnSk03b2d2RDJBWnZpUWlaek9RSTNFaTk3U3JqQUhITXZzdzFQOXpwWXpGa0RiUUFZZXM0MEd0RnplcjMKSHlzRjNkTnBoYWo4WWVDRnArSjhaZXJPYlBROWhMdEg2aS9tblQ0QkVIL0l3WVNlNEdKMks2Y2k2Wlk4NkhKMgpRUFd6ZWcyZDhEL0JXRHBmQ3RnQ0R4QXNpZUIvVjJCdG1jSTBKT054c1phUDRWN2RENWZyYWtTRDIvRnVEREJpCjljdkkzakZZSklSUEczRkxmYWpJRC9XRVhaaDZFNkVRdWM4bHp3b2V1c2o0eFAvaG8yYkZLbWM4TXVrK21Wc3IKR1BYUGNZa3dHZy9lMFc1ZXljQ1UxRVRyWktkYXcvSU1ZVTliOTVjektsKzRZR1o1RlIwTHFXaDczRXczMjh6dQpuMXh5WjdIT2JVZ3lSUkYwUUIrUit6VTh4Z1Y5Z1YweHkxK1dNMGxMRlhjVVVOUW8ydEdWbUNlRGYxNlVmaFIyClJENHpKNDAwWDlJVzQ5WUZQZ3FEcjJrdWltVDBuMHdNMzU5TzZ3SDVEQk5FSVltQlNnY0tTNVFoQ3RaczFZYlkKUVNFbWVLdHkwaTJOb1ZCTVVMZ2FhMVoyNlVYYmtEUjBaV0czdlltOEFZOGs2cCtqK2owV0NaL015cGhTOWcwcgpyTy90MHNmMmpVOXVUNnZvWC9WcHlkbVJnMlJOVk54WDB6VW5xV1ViS0dvRmxEN2lGWjB1RzNxQWljVDF3VUpUCnl0NWJEU09LOVlESjRrcXBVK3BCSzZ5Sm1IZFFSS0d0WVlCVW5qOFJoQ2tueGVnSSs4bXY2Q05USHgxb2VreWkKU1NGeWRMRDFZVWdGVXJOem1uUTlJUEdWVVA0K2dSZDdYWi9lYjNETHRYTCs4amkzTm1JejFhUnZvRkQ5Z2tORAo0V0lUT0lEUk93MGZ3MERDVDFPcmxzUXpxS2JWU0tkSUFLK0FHVG5SZEdnK09VYkc2MU5DZXg0Vzl2MDdzSWRTCmFva3hSNURQM0pNVkRVeHEyNnUwNXI3clkxeWZkYXg5T2ZmSUZoWnQ5Y01hdjk4blpDK2hJSWIvUVo5Q1F4TlkKOU1PMGtEQVAzaFZCdXk1eUowd3lyTXVYWlRSeG5Ubk55RllrV3Fpa0hXZnU2WHpTQjFCYU54VnRWUkpZL1ZqNAo1MU1qUDk0Smx3eGU2d0JzcFNMa1h0ejZ3ellvZTVLYSsyYTd1SDhmenFJZjZtbzBxN2ZWc0FJV01LcUxwNUFzCm9YSXJJL2VoMHFsRHpLbVpISmQwNFBsMk54RGh2dUUzRXYxa2xoc0xoRnB6YS9SSjhRVit2dlhGSFBNbjBtMWwKK0ZRdGUzSk5ibFdLcGxZZEdvdEU2T2dWc09PNGQxNWw5NjNlVVVhZDlhUVY5MDA4NG53TENOOXJEcWRNOENEYwppbUZsVFduRUxWZEtUeUZEUmJxbEt2OHI1ODRKVUZzcnRya0pYcWtRUnV2NVdWY0dUSDNkU0ppNDNnTmVFeXhaCmxrR3dzelU3cS9JS285QUNKZmtKZytxcmpsUlgxMElhOG5MZFBGZlBuVVdqSTJOaEVRVzRrN0NwQzAzWkh5Z2wKU3Y4RHEydUFIemo2YjYvQ0JvYzFCS3gzK1hiMmhRM0p5VTBTbXdDS0ZZMUtKdCs3SVFWWlRCUFZrb2J6UEJ1WApESEV4Z3RVOXFXWGR1YStrOE54a3BrTnNPaW42Z2dSTURBY0ZmcHhBc093Ri94ZGpuYkxQblZqVG1CUEJPNExpCnR5ZXg2dS82WjhMNDgxZFJYZ05zRzBPd0p1N1Yrc1pDVDVlNnpsUGgreW9JNi9DbVRvcmVwVWxseEl5T3JnUXkKcXc1S3N0SHVJQlVhUFE0SXprUFdLNndoZG1wMlY3dkRscjRySnpVTlNKRXB3UER6TkR0RG1IWCt0TGcvdEZrcgotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
  admission-cert.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURURENDQWpTZ0F3SUJBZ0lSQUtCc3NzV0cxa1FrUXVzMldzY1ZGU3d3RFFZSktvWklodmNOQVFFTEJRQXcKS0RFU01CQUdBMVVFQ2hNSlZIZHBjM1JzYjJOck1SSXdFQVlEVlFRREV3bFVkMmx6ZEd4dlkyc3dIaGNOTWpRdwpNakV5TVRNeE9UQXdXaGNOTWpjd01qRXhNVE14T1RBd1dqQVVNUkl3RUFZRFZRUUtFd2xVZDJsemRHeHZZMnN3CmdnRWlNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUJEd0F3Z2dFS0FvSUJBUURIM205c0xDUHJ3OC9xdERpcXUvTE8KQm42a1JqYVFRTzBjZXpkUWxVNjYrSDFNWmJXb3l0WXV2cnJNK21EaUE5ZWVkVnRwbW5UQVVFaTg1bGtoeWxqNwpaekw2UUhmcWRnK1RXVFowUlpBTGdvcGJ6b3dNbzBZeFgrbDRmaWJlNEhQOHBGM1JFdFlyemhHd08xSjl5L2JNCmxEQjV6VkxpZXVoV1ppaHJ0enBtRmdEaWJhS3Z0UmpFU1VPd0dvR0VUTFVEWHJoOWtiVkhQMkhoemErcXVuc3gKbkZ2dnc0bGNTTkVsUTU5RnRWYzlicFZJS3lKbUVkcHlveG02S3RGRzllT1pvM0dKd2R5c2VNOVVma3hrbVpwYwpKODBwcGZIS1ZYS1JRRm9TelR6ekNpRmhhMHROUGJ4ZzRmZFVIa1NEYkZHZVFXMWo5a0IyT3BTRTVQVU9UT1VECkFnTUJBQUdqZ1lRd2dZRXdEZ1lEVlIwUEFRSC9CQVFEQWdPb01CMEdBMVVkSlFRV01CUUdDQ3NHQVFVRkJ3TUMKQmdnckJnRUZCUWNEQVRBTUJnTlZIUk1CQWY4RUFqQUFNQjhHQTFVZEl3UVlNQmFBRkZSdGRIbXBlRXM2Ny93TQp0QWcwZGdDZXZCU3VNQ0VHQTFVZEVRUWFNQmlDRm1SbFptVnVaR1Z5TG5SM2FYTjBiRzlqYXk1emRtTXdEUVlKCktvWklodmNOQVFFTEJRQURnZ0VCQUpaQjRkdGR0ZUtnR2lxNmlsb0VzYWZZRWxpVTNPV0VrblF1OHJTbUxVR0wKbXZ5U2MyWDBvc1NCVHNLYVdvSGwxUVNyb0I0UlhYMXg0M3dGWmFOUmllZ01JVU0zSkl6OTlMZmlubDRsbUpOWQovNUVteXhkOUgyU3hJZ3ZWVVU3VUVNQkdXMXBRbUJBaVRtUTBYa2Fkb3k1ZkVRUEZGYUhOekFJRk1NS3VPL1pOCjQ3U0gyRnFyVUU2VmhmSk0vUzhMRDU1NzArZnNZRXUwZDB6Yjg2Q1YxSWtaQXdvMzlSbkw0OWtXK2hOMlR0enIKOGNXZFJFUWpXM1o1N1hiRWZmd3JQMUcxR2hhdU9yditJZDFmNk02WHFwcUNCYmhZLzliZnBFeVg2cjR3TDZXNwoyT2J6dnlqZE9MK1lqRWMraUpMTllCZXNzQjhIaVo0M3V4MnB1ZC90NnNRPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  admission-key.pem: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpQcm9jLVR5cGU6IDQsRU5DUllQVEVECkRFSy1JbmZvOiBBRVMtMjU2LUNCQyw1ZmZlZmIyMzA5NGMyMWFlMGFjNDI5NTFjZTg3M2NiZAoKV1pDak9zYndlUnpxN1lKY3RQWGd1NGxDS0pRZFJORmI4MHlHSkFyVkRKb1J6ckQ3WXlja3RNQnVpaTNaQndZegpYSmFNd2E0R01pSVJYOElqMCtvT3lCK2NYRlVEMXoxMWJzSk9YWVFOSVQ4MjBiVUpVNzgwWUlCSGtNK3k2QkNYCmV3Y2FXZ0NFSU5vNGg3cHBOenFYSEIzbWk4OGwzVCtOeThLZjVQRDJEcHlMS0ZnVjQrVXR1L0ltRFVlU2ZBWkQKZW53VVQrVTMvS0VyQmhwWnRFcmI0REJGWXJ4a2diM3lDUkc0UTNZM3BsUThEN1Z3NkRSZ2xLK1F1cUZUOGF2RApJSmJNRWZEQXhhdXpKWHEvSjhHY3ZhUUxlMWRvTnR3cmQxVWhpVUxnS3RUcTRIdW1WRkV0L25mL2Zkd3BySnVRCkJkbytKOWFlVTlPNXBQVUE5N1E0NEMyNnNlVFlKWXlaQ0tFYXcwMEdCQ25EaDFFaUhiVGQ3d3gvcmJsVGo3VTgKeTRCeTVsbGxKUTNObjRLejBEVXdadmJvSm51MDAyUERab05kdFo4OTZ4RHpMQVU2ckQ3YUhiUzdIeEV3QmpUSgpjRkdJakp5dUwrOW5QeEplT0dsRFcwajVqME9LMTBEQ2cvWHE1cm85aVluczBKZGVuU3JNOHFCdFdDb2djRFBXCjJGeUgyYnFkVHlTYk5GeDh3SG5EbHd1VVNYbC8zWDEyc05nL0FSZkZoT1gyR0xmOWxhRWJvdlJuaUR0NGFaT3YKRGNCZzFwR3N4aGZMUURFZy9kTGdsNHlvS3ViYlRCMXVkRlc3UWVhOVdtYjNhYnN3czV2S3RQTGVJUHEzenNDSgpVd1VDbUJ5Zm90cVZYRWtOZFBMMlUyUCtrblNLMEtzMjFPc0JiMHp4WmhRby8yN3dOTmhGWHdaZnBka1V0YkZLCmhRYkxtcnAxY3FPTHBhY0p4M1pycHEveS9lK2NlZGM1dElqeHBPMzRHNUhCNXhQVHFMVEh3bXloVWxZQjZVYVEKRTBJK0YyNU5oUkV1enJBODhOTmZ4UXhHdWVkUG5HdXJNOTZBNTg5bmJIVmxBYlYxY3BRUS9aRG9zdUZTV0pwYgp1c0syQ29vdlltMW5pUHRBL0Fud1p4djdxUVlaazRWRVlvZTdObVRwcFlwTVFIVHRnYUl2WUZsM21DaUlYZTdQCktvTVorcjUzUG1vU0REeDNETTc4anRWYyt6OEpBRUgrZklRRFYva09hY1hFS3NrRzdTYjdyVVpCTGVHUngxeDQKTXU3ajNXSXNwTEdnMjJGdGdLVGJlaklyOGNiaDJQWXUzUkw4Tklqb1pSR2FQY25iT09JcG5TR0kxR0NvSWNLWQpaUWFRc2d3NEEzZ1ZrSHY3SXpHLzNCRktraGZlVUU3N0Q5aDAzTjlIMEp0K1JIMmhqcE1YeUc2R0tFQzVKQzdoCkNJMEdCNTBoVHNNZisvVmZLUnFYbStXN1Z2RU04U0ozeXR6SXYxbWhFT3hRN0kwdDNocFg1ZmxrS05XYnFCREEKekV3T0QwUVB0TDkvVTRNOUJvTlZiczJ2bzV0REtEQnRzb0pKbnlHcklxa0w5U1lmamlzQkxGOE1idUszcnlkUQp2RkdYcm91a2VYUXg3M3N2aFV2ak5MWjJtQWpuWmVadjU3V29QUjhqY1YrQjBOTStWRnJ4b3dnNVRtRmFJbzNnCk1wVEhIcENvNTBNMUJmRnR1ckZEcWtSYlI5SjRlUEYrYS9jeGdTbkpsUkF6UmpzajJ2aVhNblRJZFZlUWZQSnQKNGovOUptd3Y0aCthckFQaWtTOGJOd1Rzc2F1THE5eE5CdUFwSmorVkZmZFJaWW5nU1E1azNkYVBaVEJNVlNyOApjNUNnS1F2OHZKYkVVZ2M5cnpmNGFlV3UwUVplYko2bEtNOU10djRBeUdUZ2s2TFJuRHh6UE90UzJNekJ0dXdJCnlLTUhNbjRtT01tekR0S1lCb3ArS0JFVUZmVnYxSVRma2NtZ08xZWRBdEFJSkZLQWI1cFhtbFQrTUhydGZFaUcKeHNwTlJTckRpalNSVDRYVzFDRU12QTh0QjhJdzNJa3FvT1ROZW9FaVJrME1qMk01NmpjcTFNUWxYVkNKa2ZmbgotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=

---
apiVersion: v1
kind: ServiceAccount # Service Account is used for managing security context constraints policies in Openshift (SCC)
metadata:
  name: twistlock-service
  namespace: twistlock
secrets:
- name: twistlock-secrets
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: twistlock-defender-ds
  namespace: twistlock
spec:
  selector:
    matchLabels:
      app: twistlock-defender
  template:
    metadata:
      annotations:
        container.apparmor.security.beta.kubernetes.io/twistlock-defender: unconfined
      labels:
        app: twistlock-defender
    spec:
      serviceAccountName: twistlock-service
      restartPolicy: Always
      nodeSelector:
        kubernetes.io/os: "linux"
      containers:
      - name: twistlock-defender
        image: registry-auth.twistlock.com/tw_xh82fd7uinul74pwvfiibn09fxe5c6dd/twistlock/defender:defender_32_03_116
        volumeMounts:
        - name: data-folder
          mountPath: "/var/lib/twistlock"
        - name: certificates # Setting the certificates mount after data-folder since it is nested and was overridden in CRI based GKE cluster
          mountPath: "/var/lib/twistlock/certificates"
        - name: docker-sock-folder
          mountPath: "/var/vcap/sys/run/containerd"
        - name: passwd
          mountPath: "/etc/passwd"
          readOnly: true
        - name: syslog-socket
          mountPath: "/dev/log"
        - name: cri-data
          mountPath: /var/lib/containerd
        - name: runc-proxy-sock-folder
          mountPath: "/run"
        env:
        - name: WS_ADDRESS
          value: wss://stage-consoles-cwp.cloud.twistlock.com:443
        - name: DEFENDER_TYPE
          value: cri
        - name: LOG_PROD
          value: "true"
        - name: SYSTEMD_ENABLED
          value: "false"
        - name: DOCKER_CLIENT_ADDRESS
          value: "/var/vcap/sys/run/containerd/containerd.sock"
        - name: DEFENDER_CLUSTER_ID
          value: "dd0d51ac-8b6e-3f26-4795-ba30531154ac"
        - name: DEFENDER_CLUSTER
          value: "tkgm-photon"
        - name: MONITOR_SERVICE_ACCOUNTS
          value: "true"
        - name: MONITOR_ISTIO
          value: "false"
        - name: COLLECT_POD_LABELS
          value: "false"
        - name: INSTALL_BUNDLE
          value: "eyJzZWNyZXRzIjp7fSwiZ2xvYmFsUHJveHlPcHQiOnsiaHR0cFByb3h5IjoiIiwibm9Qcm94eSI6IiIsImNhIjoiIiwidXNlciI6IiIsInBhc3N3b3JkIjp7ImVuY3J5cHRlZCI6IiJ9fSwiY3VzdG9tZXJJRCI6ImFwcC1zYW0xMDU0NDItMDE5IiwiYXBpS2V5IjoiZkhMUWlVVm9UcHZCd3JLaUJPYXVZaHZnMEJiMWFEdnpjSjZkV3IvQ0RFa3gybytLQndMLzN4aTZFNGtvMTRwUHZRV2Jsd3NkendzUUVwNVJKQXAxaWc9PSIsIm1pY3Jvc2VnQ29tcGF0aWJsZSI6ZmFsc2V9"
        - name: HOST_CUSTOM_COMPLIANCE_ENABLED
          value: "false"
        - name: CLOUD_HOSTNAME_ENABLED
          value: "false"
        - name: FIPS_ENABLED
          value: "false"
        securityContext:
          readOnlyRootFilesystem: true
          privileged: false
          capabilities:
            add:
            - NET_ADMIN  # Required for process monitoring
            - NET_RAW    # Required for iptables (CNNF, runtime DNS, WAAS). See: https://bugzilla.redhat.com/show_bug.cgi?id=1895032
            - SYS_ADMIN  # Required for filesystem monitoring
            - SYS_PTRACE # Required for local audit monitoring
            - SYS_CHROOT # Required for changing mount namespace using setns
            - MKNOD      # A capability to create special files using mknod(2), used by docker-less registry scanning
            - SETFCAP    # A capability to set file capabilities, used by docker-less registry scanning
            - IPC_LOCK   # Required for perf events monitoring, allowing to ignore memory lock limits
        resources: # See: https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#how-pods-with-resource-requests-are-scheduled
          limits:
            memory: "512Mi"
            cpu: "900m"
          requests:
            cpu: "256m"
      volumes:
      - name: certificates
        secret:
          secretName: twistlock-secrets
          defaultMode: 256
      - name: syslog-socket
        hostPath:
          path: "/dev/log"
      - name: data-folder
        hostPath:
          path: "/var/lib/twistlock"
      - name: passwd
        hostPath:
          path: "/etc/passwd"
      - name: docker-sock-folder
        hostPath:
          path: "/var/vcap/sys/run/containerd"
      - name: cri-data
        hostPath:
          path: /var/lib/containerd
      - name: runc-proxy-sock-folder
        hostPath:
          path: "/run"
      hostPID: true
      hostNetwork: true
      dnsPolicy: ClusterFirstWithHostNet
---
apiVersion: v1
kind: Service # Expose the Defender as admission controller. Remark: by default, Defender will not listen on the service port
metadata:
  name: defender
  namespace: twistlock
  labels:
    app: twistlock-defender
spec:
  ports:
  - port: 443
    targetPort: 9998
  selector:
    app: twistlock-defender