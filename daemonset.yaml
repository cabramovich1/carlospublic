
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: twistlock-view
rules:
- apiGroups: ["rbac.authorization.k8s.io"]
  resources: ["roles", "rolebindings", "clusterroles", "clusterrolebindings"] # Allow Defenders to list RBAC resources
  verbs: ["list"]
---

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: twistlock-view-binding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: twistlock-view
subjects:
- apiGroup:
  kind: ServiceAccount
  name: twistlock-service
  namespace: twistlock
---

---
apiVersion: v1
kind: Secret
metadata:
  name: twistlock-secrets
  namespace: twistlock
type: Opaque
data:
  service-parameter: bDFDS1cwci9QMkJtbmNOcXB4SnhNU0tGNVMzZDZZV0lVeVFJdWRiTFV1Q1lBRTBnR3BkcTlyRDNLZi94cHZFODdJeTlPL1dSSW9lZC95TldNNXdwZ1E9PQ==
  defender-ca.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURIVENDQWdXZ0F3SUJBZ0lSQUxmY2s5VUlkaUNlcVFwR1lhSG9Jbnd3RFFZSktvWklodmNOQVFFTEJRQXcKS0RFU01CQUdBMVVFQ2hNSlZIZHBjM1JzYjJOck1SSXdFQVlEVlFRREV3bFVkMmx6ZEd4dlkyc3dIaGNOTWpNdwpNekk1TURjd05UQXdXaGNOTWpZd016STRNRGN3TlRBd1dqQW9NUkl3RUFZRFZRUUtFd2xVZDJsemRHeHZZMnN4CkVqQVFCZ05WQkFNVENWUjNhWE4wYkc5amF6Q0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0MKZ2dFQkFMUEpxK3FtU1Z6SFhtUVdkeWFrZ2lacFNvMVFaMUdEdUNSZis5WG1BSzNYTkhSVllna2VNVVd6dDRXRApwMmxuL1A2SDI3b3AzMTVHVHVGZTN2WHRhVENlbGtOL2k3T3B5eHdWZjBaZkZmNlFzVDJtTlJCeTdKSWZmZGtyCnd3SHJqYjVPOCs2R2pGQzNRMnZaL0lObUZBNkVMbHFTMUkyL1J1ZHFyT2JSR3lnOUpHb1FxK0c5TVpMekhqWEwKVVRPNVhDOHU2SlQrOHpuQnpaLzRCYlRQM3k3VjhFNnNNTWFYbFNRSFhVSng5NkFFZExhcm1JZm9Td2p0aDBCSgpEOVZ3VnRaSmlhU0ZQdzFKV3orOUgxV1NNR1JxQVR6T3lWTThnNG51SE55KzlGU1IwWE0wc2JGOCs3a3pkUnN5Ck1oWmlreFgvMFN4ZHVCNkxVZ1U0dFFjV1NDTUNBd0VBQWFOQ01FQXdEZ1lEVlIwUEFRSC9CQVFEQWdLc01BOEcKQTFVZEV3RUIvd1FGTUFNQkFmOHdIUVlEVlIwT0JCWUVGRFBMVzBzd1VsYTlHSjNOdElCSENYeXBDbUFlTUEwRwpDU3FHU0liM0RRRUJDd1VBQTRJQkFRQlFYU2pEdG04c1NhWFhpN3laY3lNTmtuaE1KTFdJVXZLaFo5c2lvVC9YClFmMlBsdDBFY0Y4ZzMxTXFrdzMxTWZ3Q0gzNkdzL1dPUE1aejdkR0Q1emE1SjdkYnZGQlYxNS9vUDdOdFArMTMKRUJMRjZFRi9rV0VtWDFaS3d0a0Rpb0FJRnRnQVIydUhIdXpGanBYWC83VFFwcDVNWGFkUEtmZnVyUVhFY3VrZQp4dTV3U2I1V3NtaGE2aUpnK2tWZWVHM1RFQ3F0OWEyS1lCMk9COU9vQXJyVi9ZVjNremVpd0pWMXRPSkdNYkJUCk9ScjhuT2dlY3BnRkVpVHVXNFJNOFkxTzdHazVzaU5pU0o3VGtac3FNTFdJbks0VUZhWDFDYWlnU0FrelNzWFoKaG5Dc1NucFBjVXRoVmtmMGk2c3pKSGlEcThWM3ZlUDV1WWdpTzlDL1hBRTYKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  defender-client-cert.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURQRENDQWlTZ0F3SUJBZ0lSQVBpOW5xY3FzZkxFa0hVTDR5eU16c3N3RFFZSktvWklodmNOQVFFTEJRQXcKS0RFU01CQUdBMVVFQ2hNSlZIZHBjM1JzYjJOck1SSXdFQVlEVlFRREV3bFVkMmx6ZEd4dlkyc3dIaGNOTWpNdwpNekk1TURjd05UQXdXaGNOTWpZd016STRNRGN3TlRBd1dqQW9NUkl3RUFZRFZRUUtFd2xVZDJsemRHeHZZMnN4CkVqQVFCZ05WQkFNVENXeHZZMkZzYUc5emREQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0MKZ2dFQkFMMGF2WFVKQXFhWmM3Tmx0Nk8vclJQVm1ya0J1RXMxMXplNGNlOGtrblQzSjVGNXV0bTU3RHFLRVd3cQphWmdZU0VVNWtENXhPMUp6Wkc3T1MwMWhYbE5TL3dpMUxveGRnZFlkU3hWdEcrZ3JHcDVoeVE2MWtCU0VaYUMvCk10Z0FuZ09EZXZCQ293OVpmWDZKd0VkZDFhc1k1cXVvcVJveitqQjdmM3Y1VHFzU2tyaUNiaStqaXN1ZER5Z0IKQlZ3M08wV1VaYmJ1cjBUdjR3bnBLc2M4dGoxVFc2clJmQmpkL2FtaXJuOXArcVUvWVl4N1F2TkF1UUtUTkRGaQpPMDhubWd2Z0ZxcmovbERCVmNJRnN3TUZzOE5kclZTNGNPSmNOYXhobjl5aDR0NUZSZVg4TEFLdjJndW1QWFo3ClZGQWFqeDVjTGJ6T2I4Wjl5bmxwU2ZiTmF4TUNBd0VBQWFOaE1GOHdEZ1lEVlIwUEFRSC9CQVFEQWdlQU1CTUcKQTFVZEpRUU1NQW9HQ0NzR0FRVUZCd01DTUF3R0ExVWRFd0VCL3dRQ01BQXdId1lEVlIwakJCZ3dGb0FVTTh0YgpTekJTVnIwWW5jMjBnRWNKZktrS1lCNHdDUVlGS2dRQkFnY0VBREFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBCmlscmZyU2F4Qm1Ra0VNbTRMajRmck04WkxmelU0NFJ5OU5mNytsWnk1UXQ1eTBwWlpXVTh2ZWNGZmp3VCtzbkUKaTJIU2NVcnpjbjIxSk1TRjJtTE5Zcm1nNjFOdmtRVURvRXlDTjM5R3NxdFJvcVBhdVRGeE9Qd0ZMRE5JQ211UQpxUEpPWGF5c2JsY0FkZnJSdmVEeTExeU8zR2FSVjlzTUE1SHdlMmk2cFh0QUZoOGc0bytrajA5bnhWZG1McVRSClBkcWI5M3BVdXdwMDNLOVpMaTRkUmlSbUJtNEhoM2hwRWdmeFlpUW1xSVRnMWQxU3dZQnVEd0kyL0tLdnhQVVMKOG5BSGJoRnVNNUswcGY5T3gzbjdiU1pkQUhRdjlST0FNYnVQUWlQSUN3QkdyeE10SFRKVHBpYkxnZHpqditacQozQk8wT0dJbU41Ny9JR3B1a044TzN3PT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  defender-client-key.pem: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpQcm9jLVR5cGU6IDQsRU5DUllQVEVECkRFSy1JbmZvOiBBRVMtMjU2LUNCQywyYWYyZWFlODVkZDg2NjEyNjQ0MzE1OTM0ZDc3NmZjMwoKendLNUhxazBOYzRGb1Zkb2FFVk00VE8wd1VNOWJoY0I0aWtJVFg1d1JvRklqV1RVNWRjTmxkWjIrc2FYWnl6bApzTmNBQmlRZVhrTEQ0OUdiaCtreGc2czdwYWIrRmhMTzcxSXUvZE1YQlM2cDhDNDQ2SW9mcGowR0dlUlQ5UngwCkYzWm0wWTZSUGI0ZnhVV1hMaFM1UkdDRkpCbVIyV090anJYdEZtYzdoeCtHYUhTcXFuU1JjWm5ldzNQT0tvdUwKSEEyRXJjaGFwbDBzeElQbGd1MGRwdm03NnRNK2V1MXJ2MGp6QW5CR01ERSs1VytGSG93Z3dBd1hsVHRPSEpYcgpRVDFoZ0lCZERqdm5jVkNtL1JoSVdhaUMvcGJxNkxTOWJ5aGFXZUVoc0FDQkYvcnhBUzNIa1pWK3Y0dDFsS2JUCjQ4bDFpTnJ5dllhdEU4cUQyUUg3UHBLRWF3M3hQNlZiSmhmMXU1MS81Y2Znb0xuRExIOXdGNUpYWVh6UkJ0OGMKNi82ci92S1JJSzMvelF5MjJ4Q2dEVmUzNnZ0UjFtSVNXcU44NWVoM0dPaitrUkUyUTJXL3JYTExKV2JMRHdjWQptSFZNbDFHQVNoTjFHQlI2cHl3TzM0OWdHYnVDK0s4WEh4Ujc1dmpRdEJ4LzBSOTVxdjAwaDBSWU1JQnB5WHRnCjVFKzZJQkZueHJFKzBzQXQ4bnVGQkZtRVdnTjNPaEhKQXZMdGpabHVpM1ZlTHpsbE4xd2dyVVdaaGQvQkJMWlAKRGNIaUNQRlVpYmRkWkNhdmRMZWU4bjVRQjY2SmpENVJ0Nm9Bb20yQXFuZ05EakJlTkdKN1Bad0FRdTJLUlVWTwpwOURHRVJJZlFSNkMzU2ZqNGQ1N2NSZjNLWWdIdi9Md2czMzMvTUhsVDlGQSsxZWR3SVZXTDB5dmFNVzdYTThGCnZZa1FiNDdxcWIrOFAzK0hxaTAxcTZuMU5hd2JGL1RPVndnNmdtbmFHb0o1VzFxZUtLMC95cnIzaXNXSTJXbFUKdmxTRXdsVnZQUFRjNVAyUytSWUFJbTB0WTRwSkErZ0s1UnFQRnRaVmFKTGMwMzk5UmlqSFJhNFcydytOS3hIVApUTzQrY0lTcTgyL2JhUk1sdXYxUFUrTURkMnRKNGsvaTJmSTJNT0YyV3J0MHJPQkg1SG9yNDBiS29icFo1TUMvCndFZ2c0K1BWMmdDNTEvZ25TU2FMazI5eFNuWU01SnVJc2tybEtiTDlvc1N2UElVekF0NmhVdXZKVXE5cHhvY0YKTThiRitxUkxEeTlRSnNwamJmRjRpekZvSGFGdVZFNndnWnM5eWVYeFd4RnkyZm9BVU5yRFJKRm1DanU2R3N0cQoyWU15SnF3Z2RWQ3VMQUc5aUxXS3gyS2NOQjJLYjg5ZlVha3lBc1h0OERVeWU0aldRYjh1N3FTWGhPZml5c0RDCnM0c0NvRGd2UEJ0Vm40b1hyTmkxcFF6aXpMN0lnQWppQk5iNkN3R1dYZmZWM2NkY2NRYXYrMWdQeVBiOTVEZDMKdy9PUkNMdUgraCtVcGRLWURFU3U4MUZXRHI1SkFzMEhLNkM1YmRmZGNNK05HRGY5QW11U2FaNTQ2UUwzazh1RAp5M2Z5Y1ZWTUEzN2tQK1BDV1AwRUhXbFQrMDM1MHNSLzR2WGZ5M2l5NXlNK095Q3g5Ty9FZ3JaZE5jekE3cE42CmphcjVzdTdISWNmTWRmMklKc0lYVWtsRlE4RDBwQUdsbmpyS2h3Q1J1U2tsWWpXODJWZHhLazlaZ2VOV01aYkcKa0E0RkFIblBZK05sa2VPRE40WU4rc1loZmludmZVT0xVb0s0akkvRjZkbmpkQzFuYzJnOHJnN2lqUG8yYlR5ZQpONDRZNUxrM1RUY3RmcG5OZHdySU5DYVArbWUzYTJ3OXg2aU9rbUxkV1pNZFNvNy9jK2JCYWZldUhQVnBsNHpDCnNYc24vME1TcVV0Ulp4RU1hcDBqYmVhUmkveTVsaGdKdmNRQ01NU2NNMDM3RXBoeVNNcHg5cDZ4d2h1aTdkNHYKanUydVVUWldLeTdBTXdJcXlzUE9aZVJjZE5sd1ltck9xTFBjeEVRRkVCRmZTUHpHYVFOZ0d5VmFFeElMMFlpUAotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
  admission-cert.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURURENDQWpTZ0F3SUJBZ0lSQUxXWUxBb2YzSDhuUDlhTXJDUzgxMnN3RFFZSktvWklodmNOQVFFTEJRQXcKS0RFU01CQUdBMVVFQ2hNSlZIZHBjM1JzYjJOck1SSXdFQVlEVlFRREV3bFVkMmx6ZEd4dlkyc3dIaGNOTWpNdwpNek13TURZeU56QXdXaGNOTWpZd016STVNRFl5TnpBd1dqQVVNUkl3RUFZRFZRUUtFd2xVZDJsemRHeHZZMnN3CmdnRWlNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUJEd0F3Z2dFS0FvSUJBUUMvRW5MM3pCK0xURlJkdjZRZVJGSVEKKzdDeC9yV2ticU5xWitLM1V0dkJTTVJWb0MzS0tYZk0wS2VQTGZmMzFtSkYyVnFINWZsd0hlcEw0a0o3MjRQLwoxK0ZRNHhJL3plU2c1RnpER2hicCtDb3k1TUw2M3FBQUw5Tks2bkFvVnhrNkZsS29IYU5uZitwUWRPZUN1a2dhCjJMYXZvVmN0NUpuamphTi9ROFhlN1NFMHNKbksrM2xDSjBLRElnN1lMZUpDNFBTclYrTmlJYjRoR3FGRVZTTUYKamdxSGo5T3F0ZHI2T21LWDZpUjlubkVsL0lrNWJhQkh0U2RIYVNjN2xiVnBlVlY0ekl4cEJFeHNOS0RmelN2bQp5bWFCTG1iWFU4Z3hvbUlyNmhrejM2TTBSS3BRZUppdHd2TVJPdzFsNENZdjhnWUVjTVo5UFoycHZwQTRiL1ZkCkFnTUJBQUdqZ1lRd2dZRXdEZ1lEVlIwUEFRSC9CQVFEQWdPb01CMEdBMVVkSlFRV01CUUdDQ3NHQVFVRkJ3TUMKQmdnckJnRUZCUWNEQVRBTUJnTlZIUk1CQWY4RUFqQUFNQjhHQTFVZEl3UVlNQmFBRkRQTFcwc3dVbGE5R0ozTgp0SUJIQ1h5cENtQWVNQ0VHQTFVZEVRUWFNQmlDRm1SbFptVnVaR1Z5TG5SM2FYTjBiRzlqYXk1emRtTXdEUVlKCktvWklodmNOQVFFTEJRQURnZ0VCQUU5SVZXcWRDRmZEZXhVUGxPdUtNQjhabzAyUTRWY3V1QU9zNmlqM0JpSncKWXFKeXdLcmVYVkFpa0RGLzJqR2N1ekdaWkpyOFY0cExWMkRzR1hkQnJib2Z6YlA4b3Jmc0NtY2ZLdktmZmhBSApZVW9keEpsNlFQRVovb0Vkd0xFWDYvOUhaZ2NxVDRiMDhsRlUrNjM2amxEbXlXajJJcFNKUU9TbHdZNW5wMTZlCnBVLzVPVlM4UHd4RVNLdU0xbmt1TzZpTXpxZG5Lc1c0K2U4NjV5TExWNUgyNmxNOTh1SXRCbnh0ei9aamxBNmwKSzFsUG95b2FCOFRZc3FjRTFLUlpvbFZHR1FmRUFZM2luVHo5Mm05R3hoZng4L1pySkFmai9XajNIVXcwbENqTgo4cURWNmQzb1R3b3loNEdTT3V0VThvMDVWdlFWZS82Y0tDeXZtemFNT2VzPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  admission-key.pem: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpQcm9jLVR5cGU6IDQsRU5DUllQVEVECkRFSy1JbmZvOiBBRVMtMjU2LUNCQyw1OGQyNmMwNDI4NzNhOTE3NjkwZDM2M2UwZmI5OGMxMgoKaFBmQkFVaThzZHE0WmZvNVV1UUhxd3g0Mm1oeWlGaFE4UWI1UlpXQXNINmxYdWhWODV5Um1NVjRmbUZMVVdiNgp5TVpBMG9nWEJlT01meWdFYnlOVjZqUU5zd3FBUjBSNnMwQ0FpMitaREh3bW01dVVGNk5vRHVxcVpqMDFaakVLCkZ2bytUQ0xwQ283NTdCbFlkNEdySUR2bnVYaHpDTFQ0K3lEZE5DL3NLWU1NcEo3eDFWUGxsNGcrTy9KdkUrbkYKdDdXL29wSENNeFJESWRhclhKNWdTekNJd1o5ZHpteG1uc2NVaWhqZTNGVGtNVW43S1JiV3NYcjBiUWZsbjQ4bAo0ekFydGQ2L0NnbVF1ZS9Sa1Y5Y0NVZGxqeldEZ2hVSnEzUldHMmdKY29lZjFlRkhLVWJQZVhXNjgyYzJpNjNHCmJ6WkgzSDkvSDhCdzRwbVBacUZ0VVFTdkZub3JVUjdtekJ4RTE4ZFFIeDNqMTl5UVJYbmxOeEc0ZEp0a1pFT0gKM3o3aVVKdG5qTFRZbHRKTGVSK2xaTGQvWktFcGx6d1JEbnM4dWdlOG1pdnZGdkFOSERjWFZOemxEWUI1RUMvMQpJK0ZYaWM4QUg2S0dKU1pwektDVER4elh1Y1dPOVgwRjBLdExyZitva2dWTmhlUzRuWHViRVczenN3SGZqMGN0CmdKNWNTK1lhdmJ3cEtVckVwSkNWekxLWm5qMi92bExtMU1RRDFZYnRtendUanZmbjRjS2RiTThmUHJQbkNGbnkKY2ovVGo0NWxhNzRGbTBrbjFHMHpGd1orb24xNkhCVmxmSVJIK2xXU3BSVGJpdlErSjE2R0FSVkVDZldhOGVIZgpPTGNYTzUzUUVBOHNBUlhIOXBXaUhnb0lMc2YxZGx4dS9TRkpzclR1TWtyVmZkQ0ZXamV1RmhBMU4vRzdwbitHCmU1NG4zeUp4SEZ3Nk1PdUV6em1rMU9jcmExWGU4VW1CemFXZCtmb0o3WndvdzYva0FRdCtEU01jbU5YZWxKRXoKUUZzUFdwQ1ltRTBzRldQaFBtWVBFeGRCdW9oY1NONnM5L1BGT2RWTkZOdEN1VXg0K2VsNURZYzdTWDNJem1BSAp2TVpNQm02dXZvQll5ZktpS1lkbUgxUS9TWXFpNUI3NFpqaU1hRWhUZDJoZzVmdFpVUkJpMHBOTFptQmhyVnNqCkQwcUhVajZURzE2bE5KTFNzZW4vNGdTMVpVQUV2SFFwMjZTQ1BvKzFsM3F2V0Z2aDZtNHpKNzUrRUV2QmZ5TlgKeGpkM0ovQ2paNWxxUFFXZjgvWUtaMUlyMmJMenpOWnhMZUx4VTdSSU0xMzhTNlpOUW5hOGJLMWcwT3RVemY1RQp1UDV0elFCNGl1Ri9Od3FydWlrNGhYdFpHckZLTENDc3VFZkJHdHRZYU84VmNKWVBTT1VDcWxHbGRlSnozQnF5Cmt6MHREYXhmNVpaYlhPazJndHFMc2dpQlJkQzNsYlVydXNNNmVqdWFobkd5ZndwMWg4bW93SERZclpIeGxJYU0KWFJBd1AwbzhoZ1M4ZlBkbURqaDJZcEJlYW5DVERleUowZS9OVXhuRld2YXJ2YlVIeUJtTkJRU0lTakhzY3d0MgowM2ViZmdYVkNlQXBhZnBaZ2h2b0tCYUc3dEhtbUkyRWpCQldKSXhYTzZaTGp4MUZQYnVCZnYzVzlyTFBodmM1CnZ2aWtWK3ViVngvYnBMaVZiQlkxbXMyS05hQ3YrWmFwbXU3amlDTEhYaFduNk4vSXA3M0VVaUMzVXF1T2F5N1oKelF3eDZGUGVoNFY1engrbHE0UnZSS0puRlVnSWdzbkh1NmF1OWRCU0l4a1dTZ1dkalJRS2JzMmRjZk56L0V4dgo1QUtIQ1hWQTdkSlR4UXdDY1MrY2ttWmMrMUdJN2lPTXlHUU13NGVYWnJpKy9kZzJTSU45UUVVOEFtYlc5L1Z3Ci9PZ0ZJS0htYWRaOEJMVDhTNzVCQkhRZVdIZ2hnTGIyZ2dBU2EwdWY1Z0kwY1RQa3Bqd2dBMTFFMEVmMlBLUlkKNFdKc29RS0M1S2JjSVEyZm1TM29GakhURzhpT01NQ1l5SFlydjJJdE56OXp6d0pIa3I4VElqNnVSeG9FNTVwLwotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=

---
apiVersion: v1
kind: ServiceAccount # Service Account is used for managing security context constraints policies in Openshift (SCC)
metadata:
  name: twistlock-service
  namespace: twistlock
secrets:
- name: twistlock-secrets
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: twistlock-defender-ds
  namespace: twistlock
spec:
  selector:
    matchLabels:
      app: twistlock-defender
  template:
    metadata:
      annotations:
        container.apparmor.security.beta.kubernetes.io/twistlock-defender: unconfined
      labels:
        app: twistlock-defender
    spec:
      serviceAccountName: twistlock-service
      restartPolicy: Always
      containers:
      - name: twistlock-defender
        image: registry-auth.twistlock.com/tw_xh82fd7uinul74pwvfiibn09fxe5c6dd/twistlock/defender:defender_22_12_694
        volumeMounts:
        - name: data-folder
          mountPath: "/var/lib/twistlock"
        - name: certificates # Setting the certificates mount after data-folder since it is nested and was overridden in CRI based GKE cluster
          mountPath: "/var/lib/twistlock/certificates"
        - name: docker-sock-folder
          mountPath: "/var/vcap/sys/run/containerd"
        - name: passwd
          mountPath: "/etc/passwd"
          readOnly: true
        - name: syslog-socket
          mountPath: "/dev/log"
        - name: cri-data
          mountPath: /var/lib/containers
        - name: runc-proxy-sock-folder
          mountPath: "/run"
        env:
        - name: WS_ADDRESS
          value: wss://staging-consoles.cloud.twistlock.com:443
        - name: DEFENDER_TYPE
          value: cri
        - name: DEFENDER_LISTENER_TYPE
          value: "none"
        - name: LOG_PROD
          value: "true"
        - name: SYSTEMD_ENABLED
          value: "false"
        - name: DOCKER_CLIENT_ADDRESS
          value: "/var/vcap/sys/run/containerd/containerd.sock"
        - name: DEFENDER_CLUSTER_ID
          value: "93d87656-a275-2a50-8406-3f7a4e17c55c"
        - name: DEFENDER_CLUSTER
          value: "tkgm-carlos-photon"
        - name: MONITOR_SERVICE_ACCOUNTS
          value: "true"
        - name: MONITOR_ISTIO
          value: "false"
        - name: COLLECT_POD_LABELS
          value: "false"
        - name: INSTALL_BUNDLE
          value: "eyJzZWNyZXRzIjp7fSwiZ2xvYmFsUHJveHlPcHQiOnsiaHR0cFByb3h5IjoiIiwibm9Qcm94eSI6IiIsImNhIjoiIiwidXNlciI6IiIsInBhc3N3b3JkIjp7ImVuY3J5cHRlZCI6IiJ9fSwiY3VzdG9tZXJJRCI6ImFwcC1zdGFnZS0xNDAxMTAzNDkiLCJhcGlLZXkiOiJ5K2diZkxyMDlRVkppdnV4YXpkZWtyWTVGZ0ZiZlRLa3pBQXZRbUQvZnJXOUZOc05haEdFbzFMWll5T0ZiZmVzK0lGa1JsRmMrdnR0aU1EZ0gwQ1FvUT09IiwibWljcm9zZWdDb21wYXRpYmxlIjpmYWxzZX0="
        - name: HOST_CUSTOM_COMPLIANCE_ENABLED
          value: "true"
        - name: CLOUD_HOSTNAME_ENABLED
          value: "false"
        - name: FIPS_ENABLED
          value: "false"
        securityContext:
          readOnlyRootFilesystem: true
          privileged: false
          capabilities:
            add:
            - NET_ADMIN  # Required for process monitoring
            - NET_RAW    # Required for iptables (CNNF, runtime DNS, WAAS). See: https://bugzilla.redhat.com/show_bug.cgi?id=1895032
            - SYS_ADMIN  # Required for filesystem monitoring
            - SYS_PTRACE # Required for local audit monitoring
            - SYS_CHROOT # Required for changing mount namespace using setns
            - MKNOD      # A capability to create special files using mknod(2), used by docker-less registry scanning
            - SETFCAP    # A capability to set file capabilities, used by docker-less registry scanning
            - IPC_LOCK   # Required for perf events monitoring, allowing to ignore memory lock limits
        resources: # See: https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#how-pods-with-resource-requests-are-scheduled
          limits:
            memory: "512Mi"
            cpu: "900m"
          requests:
            cpu: "256m"
      volumes:
      - name: certificates
        secret:
          secretName: twistlock-secrets
          defaultMode: 256
      - name: syslog-socket
        hostPath:
          path: "/dev/log"
      - name: data-folder
        hostPath:
          path: "/var/lib/twistlock"
      - name: passwd
        hostPath:
          path: "/etc/passwd"
      - name: docker-sock-folder
        hostPath:
          path: "/var/vcap/sys/run/containerd"
      - name: cri-data
        hostPath:
          path: /var/lib/containers
      - name: runc-proxy-sock-folder
        hostPath:
          path: "/run"
      hostPID: true
      hostNetwork: true
      dnsPolicy: ClusterFirstWithHostNet
---
apiVersion: v1
kind: Service # Expose the Defender as admission controller. Remark: by default, Defender will not listen on the service port
metadata:
  name: defender
  namespace: twistlock
  labels:
    app: twistlock-defender
spec:
  ports:
  - port: 443
    targetPort: 9998
  selector:
    app: twistlock-defender