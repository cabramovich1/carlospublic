
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: twistlock-view
rules:
- apiGroups: ["rbac.authorization.k8s.io"]
  resources: ["roles", "rolebindings", "clusterroles", "clusterrolebindings"] # Allow Defenders to list RBAC resources
  verbs: ["list"]
---

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: twistlock-view-binding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: twistlock-view
subjects:
- apiGroup:
  kind: ServiceAccount
  name: twistlock-service
  namespace: twistlock
---

---
apiVersion: v1
kind: Secret
metadata:
  name: twistlock-secrets
  namespace: twistlock
type: Opaque
data:
  service-parameter: STVpV1dHOWtGWmNiVE85bkdVT3kxOWNNeVJoZ0QyWlB0Z2laRTQyWVM2SkkxRFlmUG9RTUZ4Z1NteHVLMnVxc1F0ZjVIeGJtUmhoTE82cFJlMmFWOUE9PQ==
  defender-ca.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURIRENDQWdTZ0F3SUJBZ0lRWHh2SlZSSGNDVmVlZ05tTWxRMDRyREFOQmdrcWhraUc5dzBCQVFzRkFEQW8KTVJJd0VBWURWUVFLRXdsVWQybHpkR3h2WTJzeEVqQVFCZ05WQkFNVENWUjNhWE4wYkc5amF6QWVGdzB5TWpBNQpNRFF3TmpJeU1EQmFGdzB5TlRBNU1ETXdOakl5TURCYU1DZ3hFakFRQmdOVkJBb1RDVlIzYVhOMGJHOWphekVTCk1CQUdBMVVFQXhNSlZIZHBjM1JzYjJOck1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0MKQVFFQXA5ZkxOMXFWakJKdFZBQUpESzhtUk9Sb29ZSktBK3FGamRwRGcwY2tVSUJWNDdYT2FOZE9wTCtlcHVvdApJUnlIWTNqVmx4SExMR05qR2FVZkRrbFRseDdjZVNlWDQ2ZUZ3RzRYaU1nZnptaG9TbnBrSEhGZFBNYm5NRlQxClV1UUEwaXNaSk5Qd2tYZmc1by94YlNBNmo5TFVFV0pOekN1eUNmS0EydUhaNmdDSU54OXkxeEtpSFFDT2ZUYVAKNWcvaEc5ZTlCOHJzRnJKUnFTc2lrUU8xTlRBM3ZMWGtYWXFuK3ZDdThOVUJNWWdkYzk5a2g2RGpNeUJ5QmdmawpCbjZYTHcxQ21ZcndsbHpjMHFYSE5aNDJ6WUZBNXhqZFh3SytHUERlL21VbmZLQTUvS1lzbVZkc2JiZ3pKcDdqCjhlN25obmtKMEN6Rmk1ejloUkxNWnpWZ093SURBUUFCbzBJd1FEQU9CZ05WSFE4QkFmOEVCQU1DQXF3d0R3WUQKVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVV1Z0RHVnRPSzVZK2xNZXZKY0p5MHpxdzFjcE13RFFZSgpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFJVnpRdjFSQ05UemNrK3F6anBIcy9JVXAyZzc3SUhUK21Hb2Z5OEU5OFNpCnBlbFprQ3QrOCtBOGIwM08ra2QzOUQ1VVkxbFZRUHJjelM3MVppQ1ZkYllMeGwrUDNDK0lYYTZBNGpKYlVFeGoKNU5CT0tjN3NlTkdwM284aE0wdGVIWGVzYWFhZEtsend5NmZGb1ptSmI5Z3l6SzVpd1RSdEJ5amkxS0FCMHBPRwpYK3luUStIRXZQZEpITlNSdERNbTIxM2NFaWNhb0xETzBib0FIaUcvekd3RTk2OE1uYzcyWWZKMWZrZ2lmSzVJCmYxdnlQRlB6M08rQVAvallidFZIYnFiYmJyWnhWeENaQU14WWlMeW9FUVNjVDBWamJuNDZ2SHF0QXZYS2pkNGkKMVJRWlkySmNYT25Rd2VUblRaMmFzM3NjMlp1R05GbWY0Q0Q2eDkxRU1BST0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  defender-client-cert.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURQRENDQWlTZ0F3SUJBZ0lSQUx1THQrcnhROGdUQ01qbnFuM013WTh3RFFZSktvWklodmNOQVFFTEJRQXcKS0RFU01CQUdBMVVFQ2hNSlZIZHBjM1JzYjJOck1SSXdFQVlEVlFRREV3bFVkMmx6ZEd4dlkyc3dIaGNOTWpJdwpPVEEwTURZeU1qQXdXaGNOTWpVd09UQXpNRFl5TWpBd1dqQW9NUkl3RUFZRFZRUUtFd2xVZDJsemRHeHZZMnN4CkVqQVFCZ05WQkFNVENXeHZZMkZzYUc5emREQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0MKZ2dFQkFPUG9ialljSklwakkvcmdta3dzK0Nsb1JVdFIzNjhoZTlsQnBvWitFRGsvS011K01NcmJ5ZlV5aW5wMwo2UnZqTGZlb1ZVWmFIRy9uUUxta3RNS0tyTXJCajY4WHlINDViR1R6UXJuN3htV0lUbUk2SGJmWVk0dS9ZZ0tkCjZXUzlsK0NhckQrSk9SUGN5TEtydHd1TFdxMWVWYUJFWE9STEpUaklGUm9mNC8wKzFpUFFMcnNBckpDWWY5Y2MKVitONDFENTZIVGxCb2RnRkVXMjVkaHRFbTJVamVHcVljcmhvL2VTcU5FMm1MbC9UTjl2ZXRmajBRRHJaeEpIWAp2bENXZkxIenRVN0FueERwZVYxWC9JcnFaQVFybWxzc2RlVWgyUFowaE9QS2M2ZFpDdmpSRll2SDM3REFsYk1mCjBjOGlCSXdlUWpCdXBXbEh4akUrazBnVlVpa0NBd0VBQWFOaE1GOHdEZ1lEVlIwUEFRSC9CQVFEQWdlQU1CTUcKQTFVZEpRUU1NQW9HQ0NzR0FRVUZCd01DTUF3R0ExVWRFd0VCL3dRQ01BQXdId1lEVlIwakJCZ3dGb0FVdWdERwpWdE9LNVkrbE1ldkpjSnkwenF3MWNwTXdDUVlGS2dRQkFnY0VBREFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBCk9majdzN0ZLQ2Q1YXVzTlBjR3dpTXBLaHhNWnNaOHZSUkpUc0lIRTA2RWp3cDd2ZE1JRVlNM0dHTkhmV05ha08KcFRTb3FkQlZHTEVIVWZkcktnVXA1V0NlZWpkZ1hVdTJmZDhTQ1NQZ1JLV0NtSDBaZzVOV3NZWVVHZ0V0Ty9kOQorSHRQNGlESWdmaElkTUEvcHJNM2RhVnY2UUh6aGlwU1BwV2luTkpQZS8wcUtVZ2N3VENxUStldFhRcW5CWkw3CkFDUU5pdzdaaG1KWGwxUjBLTzliMWUwWXFrNEFmNEc3cUpVWUVVblAxWVNpWlRrVlhETGplTWpnOFd4aFJxRUcKM0RqMldDRFR4VjN2OGk2STFuaG40QzRJYXIvYVdHeHhhVmdyQzhuSUsybVRHVmNqdnRIVXFRSEdRWnkxNmtRdApmTUg5eThRU0l1b2R3YWNuQ1RJZyt3PT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  defender-client-key.pem: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpQcm9jLVR5cGU6IDQsRU5DUllQVEVECkRFSy1JbmZvOiBBRVMtMjU2LUNCQyxhN2JiOWE1OWE3YTE2OGE5ODA0MzI4NDRjZThlZGQzZQoKUXZwZUtTNUIrb1RWV1piMEVpTzIzL1c4T2k0T3JTQy96b25HdWo5MDBBZk1YTFk1SGM5S2Q5aXczT3RkMlVXQgpoa3lQd2lCTzc1OFA1ZG5pK2FTZ0xBR1h4OExlQVg4YU9qUTc4Um9NR3FlQkM2QXhQWUVMNDR6VDFJdWcvZkt5Cm1IaHVkSWo4MlpuZGdjNTNhUkVndkJ4emRkTmlld1JvTWFrNDdvUWFLNWNnbGkzTDc4MWFmRzRiaHp2MVUva00KS0FIUFpoQ2hIdS9hQnhWa2dFKzlhaWRxd0E2MkxRTzMvZjQzRU11dXNhbG5GVkN6bHJNdEllSDF0YVJyYlZZdwpzZkpkREwyUEd3ZUJHYmxZZFpSWWx6U1hmellHVFE1aU03eTBqYlVqdzNlNEduQXhrSldndE92djBmc0QxQ3MrCmc2LzljeXZPQTlUeFFpK3lDS1F1amRrdXc4aEF0L3R2b3hTV1pjRGZLK1g5QVFHMjRJSkM1ZlNVeGpXOExwRjAKajJ5SnljUEZtVFRQd2VmbnVOK1labUJENU5uWE5seGN0amdLaUROanFEWHptV3lHV3BZTGlNWmlHTUlpWldSQwpMSUJ1QVBiNFdlY2xEalVMb1ZaSWRHVlhZdm5iRWdEeDRCWmVJeUZaZm85Q0ZxTm1rRW5jNWliTnA5cTR2UHFCCldUYWY4WVVSUlgvYm5PMFdvZnRRWHFJZ1JOZkFLT0tFYzlzenE0WGwrWWdmcXlOREFYS0VobEk2L0k0aENudU8KRmxkN2JzcHcvVXR4TTZxNmhWOWF5c3Nub1lkdDVCQ1FRVk92aHRXeHVScjI0WG0yakQ5R08xNU9rMHRIL1E2bwpvczFEc0JqUWoyNjczSTk1MGJTa1ZuUUtDb1hKRFVnL3B4YzdBNDFXdnc3SWxTOVhsNXl6RHRKSzRPQnlIVXhWClJnRUUvZWlKdWhCZ2tQQ1VEcHJKSzB1L2xqNEU5SnJPTFVRNjh3d2xnWmFzbWxCbnlqa0o0QWswdm9jNlNUNEYKYU90Nis2SmVaVUpyZmd4V3hYUnBUTkRDTCsxTGV4VENXTlNCdUpFTnNrTTliakFDQ1pGaFczMEpOdC91bUN1aApkTEZtZjVrRDdGNW1lT0NPbkh2OFVBRWdvMmxYV2lnL2pQQ0Z3SEZaWE8yWlN0MW8weGx2K0kxSUlJOUxZeWxECk9paWY5YW5XZmFPMU40V3RFbXhJbTF1QXEwUnQzRUpOUEZMSzV1QjUzdkFUbE1rL2pmcXg0bjI3NHo5VzkrU3QKV1RGY2lya1hhRmgyQTZkTzlTaEJYcDU5UlV5Rjg0RC9oTEFOTVM3bTM0VTdkYmJZWVRCd1lTbFVsdFlvc013eApUQnVaV0EvS0ZuWTM2VUdRektVblJVc2lTd1R3cEhJM3FKdEFCano5YU00cTF0TGtCUnJvZ2E1L2JaTklyUWVUCk5uYy9wZzExcTNzN0F1YmhnVkxsQ3BWakhXUWxtcGcyMzVtL2laSFVqRkU0TTVrbW9vNzdJTUpBcms1MGVyUXgKYXNYT0JFdkN5aXpFWmF4Zy9KOURmaFFzTVRJRnZyTnNrOWwzbEppVFNOcTNSSnBSdEpVT3BNSWs4SDAzMUxteQpvWW5GaHBNdGdIWTVRMWplbjQxdmpnaCtjc01tQnp5eDUxS3Q4TnFLcU5rWlYvU3NIU3orZkdUOWYwNkp1MWpRCml0MG9mZ2wwWUo5Umdza3NrcHNKOEdrQ2w2M3RIMHR2aEI5TDVFU2wyYW03M0IxNW9VbDQyOGFZNU9LeXRNbGgKNDQ5TlZFcWYrVTd6dmpKUmRaRUVwZ0VhOXdldExCc2NhZlovWnNWK1dVbXZRZXNzdnpKek9vTzBBMUs4QWRVcApPWit1TkRuTzZUb1d4ZW9DNlBrV05ldEU5VlN4R0JDcXFMc2lqZ1dhWGdiTktvMnJBSnRxeVJWaGhGVkZXeHJGCllpV1BJY3ZNUEl4Ukw2b0lGOERqN1J6aWsrbWtQbG1NcVdlcjRVWm0wUGt3QWNqa1RZSmhVd1lBV1JxU1V4NHAKRGNHdkdRb2FEMklRTExXWHdsS3VEVFpWbmRic2R4VmRYb2NISDZkbUhCenlaa0tkWXFiWXRrNVYzMHFLOTd6UAotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
  admission-cert.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURTekNDQWpPZ0F3SUJBZ0lRTmp2UVVVWE93MmpuUXdxVnI2M3I4REFOQmdrcWhraUc5dzBCQVFzRkFEQW8KTVJJd0VBWURWUVFLRXdsVWQybHpkR3h2WTJzeEVqQVFCZ05WQkFNVENWUjNhWE4wYkc5amF6QWVGdzB5TWpBNQpNRFV3TlRRM01EQmFGdzB5TlRBNU1EUXdOVFEzTURCYU1CUXhFakFRQmdOVkJBb1RDVlIzYVhOMGJHOWphekNDCkFTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTExJd1dVYVdCZUJsUXZQOHBIWnVZMHAKSUVpQnZyRmZtZmlzWGFSWEJ3YTBpLzgrVUJ3dUpmUGh3amwyRFRtMm5vazNVK0RuTGUwZzU4NFBZa1hQVmVKeQp5NFFYUmdESjA1T3VMaitSamk5cU9EL045OW01TkNNbDBkUWVOM0VNdGpjbzhpNVUxcGRvSzg0NHc5emoyK3pMCk5VVWRzaHdDVFA4NnpxeUFDODhrRElVYTk4S2FOWTkySkdpVlptTkt1dWFuLzlwYWdtbnNnUlo5clYrdjJRU3gKM1hPYXNSSGtTZVJuREk2bjJtWGxweVFZa2t0K1NpaThKQUNESEhiRHczVEYzOG5BMWN5Z0h0ZWx5VitNYUgrbApyRWVQazlXemNNSHRhMGRKd2RxOWpVY2lUalVIZ20vRVpocnh4M2pnQjFOS0EwT2lHMFpXNWxWdFd0WGlML01DCkF3RUFBYU9CaERDQmdUQU9CZ05WSFE4QkFmOEVCQU1DQTZnd0hRWURWUjBsQkJZd0ZBWUlLd1lCQlFVSEF3SUcKQ0NzR0FRVUZCd01CTUF3R0ExVWRFd0VCL3dRQ01BQXdId1lEVlIwakJCZ3dGb0FVdWdER1Z0T0s1WStsTWV2SgpjSnkwenF3MWNwTXdJUVlEVlIwUkJCb3dHSUlXWkdWbVpXNWtaWEl1ZEhkcGMzUnNiMk5yTG5OMll6QU5CZ2txCmhraUc5dzBCQVFzRkFBT0NBUUVBUm94aUQveEo5bS90TkxOUUxZUTJXWVhTMWx3S3RrSlNEZGQwWW5EWEZSdkcKNG1reFJXVmJFbG5Lbkt0aHNnME5RVWxMMGloUlp4N1Z6dnBlV2FGQnZ5bEVIODJyeGdJbWxEMUZaaTdqMkovYgpFczIrcEQwVUx5aHZESHZKazBnZWhXSXFncGFGUThzUmJicXBaTHNmYUMwV3pzTmZwSDg0aWxLMXlqNFFxMUppCms2YW0wWklEY1lETng1bVNKaENzY1lON1lPa1VhUCtCZDh4clJuN3E4S1FmVEhLQ3J4NUhIdjNvUnp5bjI5ZnkKQzZONGVDY3psbUtZU1hCOEVXOXo0Y3hERUJTZmhuT2loVFdycnhoeTZPUkxUd3BwR2JQcXcwK3EwNUhzeEZ6MApXNXVsM0szK3B4SGdSTC8xRDd1ZDhBQmdBeVJpWGNScWxkWDhkOWtqV3c9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  admission-key.pem: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpQcm9jLVR5cGU6IDQsRU5DUllQVEVECkRFSy1JbmZvOiBBRVMtMjU2LUNCQyxkNGJiMjgyMTk0ODkyOTVjNzVkNTZhYTNiOGNmNzRmMAoKWk9RalBTKzFuWEJXdEhIVFJjdjRjYlJweEZ1VzZXVTNhQ0oxRjFOYk0xdmxMa1pQVk9DS1NrWk1QV1ZKRGphTApMYmhoank2eWFsblVCcVRYMGl6L3BpUEtlZEVoWlQ5K0h5V3ZTUE4vVHVGZVpTYnJMOG9ISEpCRWQzckwrbkxGCitPVktTZkVBSzJsK0FINFNaQnRRbktBOFpPdXpEdkJZRjVrNkhIZ2NjeTlpaXhsc055MldHdHVZNGxkdnhqVzIKdkkzOFkyT0lHV3pROHZkKytyMjJwZXFSMHUxMmFpRG9vT0FMWVFzdStPSjZGV1RRTkFLMmJVM0VyNjhFSjhweApLRzV0cU1uN3NRZGFrY3ovWnRSUXRNTk9LWm1uU0hsUERhVVVTVTJjZGFtK0g1R1NhdFFBejJHTS9pZjFsUnhzCmZycUVWYnc1aXZGc1V6OFgwNmI0d3AyYnZtRURsSWljZUlXS0paVGVtM21EbXc0SjFzVnYxOGNBZ3RRNTFyc0EKOEZEV2czbXZiN05Iakt2TnEySWJTcmNoSzJmaVltMTZYTUJGMXdGbmRHanc3MThVQmZjalNoKzFZUGRLLytvSAo2WWR0NWhCTS9MWldnQTB1QnFibURyNFhCUzR5T2RvM3ROaUVuQVJvRHI5WnByc3UzTzdjbXBzSFhNWVZWbko1CmQwTmZ3SFdqdDdqWFBjMmdENUZaYlJtVnp2TXpmblR1V3lLTHhUcDNVQUd2MUxtbUJvSEdlMDdvY3c4b2NXbnoKZUdLRitlcExoT1JWSXg5Z28vbzJYRitVVmJUUW9wZzlhS1loOXV2MGlYdWlVNkE2SXNkUE1hcEQ2c3N6WmluLworcHVDS0R0WTdFdHFsSzY1MndPeDh1THdNZTZuVWZQVFMwb0FkcmJrdCsyZ0gvTkQ0T1BLd3JYVGNyMnpJR3RRCnhwdUhBdnJjTDMwTzk5V1pJUDE4bm9xdklPZFA5ODFBV0R1Q1Z1Zm4vVEwrb2tJc25mZXRKMzZCUG9sdGYzSDkKTkhtWlZza3crUjRqLzhidUpJR3Y0VEFwSjBmK3FpMFl3ZE0xZjJkdFRubUY2U2l1TkJVckl3VktjV2NTallTeQo0dUoxeUt3eWhMS3FlUnZydkZsekFQVTNFWkxyV0Z6eFpmTzI0V2pyc04zWUJPam95ZndJN00xRWo1cnFSR3RyCmEzdlBrTmVYb2l0QndTZXp0WXdoWWJ5dC9yYnpvdWlJZ0IzcUFTcXJOKzBMbUJ4VGhGRkd6VkFQQTFDM3NGN08KOEJTKzMzUGtGOUxyNWhRQWpLV2FaTldyQ3oraEZlNUVsM095M0dKdmRtTXZjZldXNTkvOXVxby9iaE1CTU1GSwowY2s4M1NENkdEc1IzcThPZk9KZzR4VzNycnhha3ZiV2hXWC9LeVVhRkxsaWRVODJVMkNUNUhZTHRWK3ludVdaCmNlVzczaGxVcTlhU3ErRVpSSVNjclQvYWZXV3czcTlnZEJadVNKanRHUWJEOUZEZ0pWQW92ZkVZMEcwMVY3M0gKa2JTRVlvV2lXQmk2THh0RGMwemErZ05xVHhaYnE4L25VQmJCOUV0ZzBhRS8ycm50aGlvazFxa1JVTXNJNkJ1dgo2cDVTUTJxbWJybFp6V3hldkNCNFZFd0JBOVE5QUkybEtPano5R3FoZTFaSVhETllzL1BybnpTaVY5RlJDNmxXCmdhMUphM0JQdDZQU24weFRtQzhDUVlvY2lTNldqd2kyNkNYN1hhbExmQzZBcjY0RUFRdkVRa3A0eVRFYVMvbVoKQjNYMlV0bGIwR3d3THZFYjRTZXVySGl0MFV0L1FrNmdFbXQrdDFuUjVrYTRrMVV0aklPbDJlbkVkcUNNUCs4YQpxZGduZHdkbXJZRFdkWm1Uc2hJT043NFhVNWpaVkMvUWJUYU1DbGZUK2cyUE5hRVA0WGNRNUVJTjl0cng1MGwzCldvbGpNTXhwblgwSDJpOThSYm9pSXorbWRVM3ZjbE4rNWFmMElGSERhQnFuUjVnQ3g2U2h6ZVdPVWorTmVaK3MKS1pDUG0vZlIwRU85R0NIQ1NSQVdLVWJKdDRZV3NKWXRHZmo4a0kwb3ZlMDErSGJDYUxneUovY1FhSmE1Nm85QQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=

---
apiVersion: v1
kind: ServiceAccount # Service Account is used for managing security context constraints policies in Openshift (SCC)
metadata:
  name: twistlock-service
  namespace: twistlock
secrets:
- name: twistlock-secrets
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: twistlock-defender-ds
  namespace: twistlock
spec:
  selector:
    matchLabels:
      app: twistlock-defender
  template:
    metadata:
      annotations:
        container.apparmor.security.beta.kubernetes.io/twistlock-defender: unconfined
      labels:
        app: twistlock-defender
    spec:
      serviceAccountName: twistlock-service
      restartPolicy: Always
      containers:
      - name: twistlock-defender
        image: registry-auth.twistlock.com/tw_j0x0r0d5pyayln0jaik1duc0zd8hq4r9/twistlock/defender:defender_22_06_202
        volumeMounts:
        - name: data-folder
          mountPath: "/var/lib/twistlock"
        - name: certificates # Setting the certificates mount after data-folder since it is nested and was overridden in CRI based GKE cluster
          mountPath: "/var/lib/twistlock/certificates"
        - name: docker-sock-folder
          mountPath: "/var/vcap/sys/run/containerd"
        - name: passwd
          mountPath: "/etc/passwd"
          readOnly: true
        - name: syslog-socket
          mountPath: "/dev/log"
        - name: cri-data
          mountPath: /var/lib/containers
        - name: runc-proxy-sock-folder
          mountPath: "/run"
        env:
        - name: WS_ADDRESS
          value: wss://104.198.214.125:8084
        - name: DEFENDER_TYPE
          value: cri
        - name: DEFENDER_LISTENER_TYPE
          value: "none"
        - name: LOG_PROD
          value: "true"
        - name: SYSTEMD_ENABLED
          value: "false"
        - name: DOCKER_CLIENT_ADDRESS
          value: "/var/vcap/sys/run/containerd/containerd.sock"
        - name: DEFENDER_CLUSTER_ID
          value: "8c857b3a-d8df-93ad-1f15-2dc457fe03ff"
        - name: DEFENDER_CLUSTER
          value: "TKGI-1-14-2-carlos"
        - name: MONITOR_SERVICE_ACCOUNTS
          value: "true"
        - name: MONITOR_ISTIO
          value: "false"
        - name: COLLECT_POD_LABELS
          value: "false"
        - name: INSTALL_BUNDLE
          value: "eyJzZWNyZXRzIjp7fSwiZ2xvYmFsUHJveHlPcHQiOnsiaHR0cFByb3h5IjoiIiwibm9Qcm94eSI6IiIsImNhIjoiIiwidXNlciI6IiIsInBhc3N3b3JkIjp7ImVuY3J5cHRlZCI6IiJ9fSwibWljcm9zZWdDb21wYXRpYmxlIjpmYWxzZX0="
        - name: HOST_CUSTOM_COMPLIANCE_ENABLED
          value: "true"
        - name: CLOUD_HOSTNAME_ENABLED
          value: "false"
        securityContext:
          readOnlyRootFilesystem: true
          privileged: false
          capabilities:
            add:
            - NET_ADMIN  # Required for process monitoring
            - NET_RAW    # Required for iptables (CNNF, runtime DNS, WAAS). See: https://bugzilla.redhat.com/show_bug.cgi?id=1895032
            - SYS_ADMIN  # Required for filesystem monitoring
            - SYS_PTRACE # Required for local audit monitoring
            - SYS_CHROOT # Required for changing mount namespace using setns
            - MKNOD      # A capability to create special files using mknod(2), used by docker-less registry scanning
            - SETFCAP    # A capability to set file capabilities, used by docker-less registry scanning
            - IPC_LOCK   # Required for perf events monitoring, allowing to ignore memory lock limits
        resources: # See: https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#how-pods-with-resource-requests-are-scheduled
          limits:
            memory: "512Mi"
            cpu: "900m"
          requests:
            cpu: "256m"
      volumes:
      - name: certificates
        secret:
          secretName: twistlock-secrets
          defaultMode: 256
      - name: syslog-socket
        hostPath:
          path: "/dev/log"
      - name: data-folder
        hostPath:
          path: "/var/lib/twistlock"
      - name: passwd
        hostPath:
          path: "/etc/passwd"
      - name: docker-sock-folder
        hostPath:
          path: "/var/vcap/sys/run/containerd"
      - name: cri-data
        hostPath:
          path: /var/lib/containers
      - name: runc-proxy-sock-folder
        hostPath:
          path: "/run"
      hostPID: true
      hostNetwork: true
      dnsPolicy: ClusterFirstWithHostNet
---
apiVersion: v1
kind: Service # Expose the Defender as admission controller. Remark: by default, Defender will not listen on the service port
metadata:
  name: defender
  namespace: twistlock
  labels:
    app: twistlock-defender
spec:
  ports:
  - port: 443
    targetPort: 9998
  selector:
    app: twistlock-defender